# AI Agent Instructions - DevOps Automation Site

## Architecture Overview

This is a **multi-instance Docusaurus 3.9.2 site** serving educational DevOps content in Portuguese. The architecture uses multiple `@docusaurus/plugin-content-docs` instances to isolate different courses under separate routes:

| Instance | Source Directory | URL Path | Sidebar File |
|----------|-----------------|----------|--------------|
| Main docs | `docs/` | `/docs/*` | `sidebars.js` (autogenerated) |
| Terraform | `curso-terraform-udemy/` | `/udemy/terraform-automacao/*` | `sidebarsTerraform.js` |
| AI DevOps | `curso-ai-devops-udemy/` | `/udemy/ai-devops-automacao/*` | `sidebarsAiDevops.js` |
| GitHub Actions | `curso-github-actions-udemy/` | `/udemy/github-actions-automacao/*` | `sidebarsGihubActions.js` |

Each course operates independently with its own routing, navigation, and content structure.

## Critical Front Matter Pattern

**All course markdown files MUST have simple, single-word IDs without slashes:**

```yaml
---
id: github-token        # ✅ CORRECT - simple kebab-case
title: GITHUB_TOKEN
---
```

```yaml
---
id: modulo-04-security/github-token  # ❌ WRONG - slashes break Docusaurus
---
```

**Why:** Docusaurus generates document IDs from file paths. Custom IDs with slashes conflict with the internal ID resolution system and cause build failures. Use simple slugs and let directory structure provide organization.

**Important:** The custom `id` field does NOT affect sidebar references. Sidebars must always use the full path `directory/filename`. The custom `id` is used for internal doc references and URL generation only.

**Index pages pattern** (course landing pages):
```yaml
---
id: index
title: Nome do Curso
slug: /
---
```

Alternatively, use `sidebar_position` for ordering (GitHub Actions index uses this):
```yaml
---
sidebar_position: 1
title: GitHub Actions - Introdução ao Curso
slug: /
---
```

## Sidebar ID Mapping Rules

**CRITICAL**: When referencing docs in sidebar files (`sidebars*.js`), ALWAYS use the full path `directory/filename` (without `.md` extension), regardless of whether the file has a custom `id` in front matter.

Example:
```js
// ✅ CORRECT - use full path
items: ['modulo-04-avancado/github-token', 'modulo-04-avancado/secrets']

// ❌ WRONG - don't use only the custom ID
items: ['github-token', 'secrets']
```

**Why**: Docusaurus generates document IDs from file paths, not from custom `id` fields in front matter. The custom `id` field is used for other purposes (like internal references and URL generation), but sidebar item arrays must reference the path-based IDs.

**Common error**: Sidebar references an ID that doesn't match the file's path. Always verify IDs exist by running `npm start` and checking error messages that list "Available document ids".

## Development Workflow

### Commands
```bash
npm start          # Development server at localhost:3000
npm run build      # Production build to build/
npm run serve      # Serve production build locally
npm run deploy     # Deploy to gh-pages branch
npm run clear      # Clear Docusaurus cache (useful for stale builds)
```

**Critical debugging step:** If you see sidebar errors, the error message lists all available document IDs. Compare your `items:[]` array against this list to find mismatches.

### Common build issues

1. **"These sidebar document ids do not exist"**
   - Solution: Check front matter `id:` field or use the auto-generated ID from file path
   - Error output shows "Available document ids" - use those exact strings

2. **Duplicate routes warning**
   - Cause: Multiple files with same `id` in same docs instance
   - Fix: Ensure each file has unique ID within its plugin scope

3. **Server won't start/port blocked**
   ```bash
   lsof -ti:3000 | xargs kill -9  # Kill process on port 3000
   pkill -f "docusaurus start"     # Kill any docusaurus processes
   ```

## Adding New Course Content

### Step 1: Create markdown file with correct front matter
```markdown
---
id: meu-topico
title: Meu Tópico Explicado
---

# Meu Tópico Explicado
...
```

### Step 2: Add to appropriate sidebar
Edit `sidebars[CourseName].js`:
```js
{
  type: 'category',
  label: 'Módulo 5 - Novo Módulo',
  items: ['meu-topico', 'outro-topico'],
}
```

### Step 3: Validate
```bash
npm start
# Check terminal for errors
# Verify navigation in browser at localhost:3000
```

## Content Structure Conventions

- **All educational content is in Portuguese** (except code examples)
- **Image paths:** Use absolute paths from `static/`: `/img/github-actions/diagram.png`
- **Code blocks:** Always specify language for syntax highlighting
- **Headings:** Use hierarchy (## Introdução, ## Definição, ## Explicação Técnica, ## Exemplo Prático, ## Conclusão)

## Blog Post Conventions

Blog files use naming pattern `YYYY-MM-DD-slug.md` in the `blog/` directory:

```yaml
---
slug: unique-url-slug
title: "Título do Post em Português"
description: "Descrição para SEO"
authors: [Ieso]
tags:
  - "devops"
  - "automação"
date: 2025-01-01
---
```

- Authors defined in `blog/authors.yml`
- Tags defined in `blog/tags.yml`
- Use `<!-- truncate -->` to set excerpt boundary for blog listing

## Custom Components & Theme

- **Custom footer:** Swizzled in `src/theme/Layout/index.js` - wraps original layout with `<CustomFooter />`
- **Homepage:** Fully custom React component at `src/pages/index.js` (not using default Docusaurus homepage)
- **Dark mode:** Disabled (`disableSwitch: true`) - site uses light theme only
- **Google Analytics:** Configured via gtag plugin (tracking ID: G-BRH4789ZE0)

## Plugin Configuration Pattern

When adding a new course, follow this exact pattern in `docusaurus.config.js`:

```js
plugins: [
  [
    '@docusaurus/plugin-content-docs',
    {
      id: 'unique-course-id',           // Must be unique across all plugins
      path: 'curso-folder-name',        // Source directory
      routeBasePath: 'udemy/course-url', // URL path
      sidebarPath: require.resolve('./sidebarsCourseNameFile.js'),
    },
  ],
]
```

## Never Do

- ❌ Use forward slashes in document `id` field
- ❌ Create sidebar references without validating with `npm start`
- ❌ Upgrade Docusaurus version without testing all course routes
- ❌ Use relative image paths (they break in multi-instance setup)
- ❌ Add content in English to course materials (tutorials in `docs/` can be English)

## Key Files Reference

- `docusaurus.config.js` - Main config, plugin registration, navbar, theme settings
- `sidebars*.js` - Navigation structure for each docs instance
- `curso-*/index.md` - Landing page for each course (uses `slug: /`)
- `src/pages/index.js` - Custom homepage with hero and course listings
- `src/components/CoursesSection.js` - Course cards with Udemy links (update when adding courses)
- `src/theme/Layout/index.js` - Layout wrapper adding custom footer
- `blog/authors.yml` - Blog author definitions
- `blog/tags.yml` - Blog tag definitions

## Testing Checklist Before Commit

1. ✅ `npm start` runs without errors
2. ✅ All sidebar links navigate correctly
3. ✅ Images load properly
4. ✅ No duplicate route warnings (or acknowledged as non-breaking)
5. ✅ New content appears in correct course section
