"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[9395],{7279:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"trivy-teorico-1","title":"Aula 12 - Usando o Trivy com Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/20-trivy-sast-teorico.md","sourceDirName":".","slug":"/trivy-teorico-1","permalink":"/udemy/terraform-automacao/trivy-teorico-1","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"id":"trivy-teorico-1","title":"Aula 12 - Usando o Trivy com Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Aula 11 - Introdu\xe7\xe3o ao Shift Left Security e SAST com Terraform","permalink":"/udemy/terraform-automacao/trivy-teorico"},"next":{"title":"Aula 13 - Checkov - Conformidade e LGPD no Terraform","permalink":"/udemy/terraform-automacao/checkov-intro"}}');var n=o(4848),i=o(8453);const s={id:"trivy-teorico-1",title:"Aula 12 - Usando o Trivy com Terraform",noindex:!0},t="Usando o Trivy com Terraform",c={},d=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9 o Trivy para Terraform",id:"o-que-\xe9-o-trivy-para-terraform",level:2},{value:"Explica\xe7\xe3o t\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Comandos",id:"comandos",level:2},{value:"Exemplo pr\xe1tico",id:"exemplo-pr\xe1tico",level:2},{value:"Output esperado",id:"output-esperado",level:2},{value:"Melhores pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2}];function l(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"usando-o-trivy-com-terraform",children:"Usando o Trivy com Terraform"})}),"\n",(0,n.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(r.p,{children:["Manter sua infraestrutura como c\xf3digo segura significa validar n\xe3o apenas vulnerabilidades, mas tamb\xe9m ",(0,n.jsx)(r.strong,{children:"m\xe1s configura\xe7\xf5es (misconfigurations)"}),". O Trivy oferece uma solu\xe7\xe3o pr\xe1tica para isso, valorizando a qualidade do seu c\xf3digo antes de aplic\xe1-lo em produ\xe7\xe3o."]}),"\n",(0,n.jsx)(r.h2,{id:"o-que-\xe9-o-trivy-para-terraform",children:"O que \xe9 o Trivy para Terraform"}),"\n",(0,n.jsxs)(r.p,{children:["O Trivy \xe9 uma ferramenta de seguran\xe7a que vai al\xe9m de imagens Docker e aplica\xe7\xf5es \u2014 ele tamb\xe9m permite escanear arquivos de configura\xe7\xe3o do Terraform com o comando ",(0,n.jsx)(r.code,{children:"trivy config"}),", avaliando se seu c\xf3digo segue boas pr\xe1ticas recomendadas."]}),"\n",(0,n.jsx)(r.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o t\xe9cnica"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Usa pol\xedticas internas (ou personalizadas com Rego) para avaliar configura\xe7\xf5es Terraform"}),"\n",(0,n.jsx)(r.li,{children:"Compara com padr\xf5es de seguran\xe7a de Azure, AWS, GCP, etc."}),"\n",(0,n.jsxs)(r.li,{children:["Suporta arquivos ",(0,n.jsx)(r.code,{children:".tf"}),", ",(0,n.jsx)(r.code,{children:".tf.json"}),", planos (",(0,n.jsx)(r.code,{children:"tfplan.json"}),") e ",(0,n.jsx)(r.code,{children:"tfvars"})]}),"\n",(0,n.jsx)(r.li,{children:"Retorna relat\xf3rios de falhas identificadas por severidade (LOW a CRITICAL)"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"comandos",children:"Comandos"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'# Escanear todo o diret\xf3rio Terraform\ntrivy config ./infra\n\n# Usar arquivo tfvars\ntrivy config --tf-vars="dev.tfvars" ./infra\n\n# Definir formato de sa\xedda e salvar\ntrivy config -f json -o tfscan.json ./infra\n\n# Escanear plano Terraform\nterraform plan -out tfplan.binary\nterraform show -json tfplan.binary > tfplan.json\ntrivy config ./tfplan.json\n'})}),"\n",(0,n.jsx)(r.h2,{id:"exemplo-pr\xe1tico",children:"Exemplo pr\xe1tico"}),"\n",(0,n.jsxs)(r.p,{children:["Diret\xf3rio ",(0,n.jsx)(r.code,{children:"infra/"})," com ",(0,n.jsx)(r.code,{children:"main.tf"}),", ",(0,n.jsx)(r.code,{children:"variables.tf"})," e ",(0,n.jsx)(r.code,{children:"dev.tfvars"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"$ trivy config --tf-vars=dev.tfvars ./infra\nINFO  Detected config files: 3\nmain.tf (terraform configuration)\n=================================\nTests: 10 (SUCCESS: 8, FAILURE: 2)\nFailures: 2 (LOW:1, MEDIUM:1)\n\nMEDIUM: Storage account should have secure transfer enabled (Azure)\nmain.tf:45\n\nLOW: Use managed identity instead of client secret (Azure)\nmain.tf:22\n"})}),"\n",(0,n.jsx)(r.h2,{id:"output-esperado",children:"Output esperado"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Lista de arquivos escaneados"}),"\n",(0,n.jsx)(r.li,{children:"Total de testes e falhas"}),"\n",(0,n.jsx)(r.li,{children:"Severidade, tipo e localiza\xe7\xe3o das falhas"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"melhores-pr\xe1ticas",children:"Melhores pr\xe1ticas"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Integre com pipelines CI/CD para impedir aplica\xe7\xe3o de c\xf3digo inseguro"}),"\n",(0,n.jsxs)(r.li,{children:["Sempre use ",(0,n.jsx)(r.code,{children:"--tf-vars"})," nos testes por ambiente"]}),"\n",(0,n.jsxs)(r.li,{children:["Ajuste severidades com ",(0,n.jsx)(r.code,{children:"--severity"})]}),"\n",(0,n.jsx)(r.li,{children:"Crie pol\xedticas personalizadas em Rego se necess\xe1rio"}),"\n",(0,n.jsx)(r.li,{children:"Analise falhas com criticidade: nem tudo exige corre\xe7\xe3o imediata"}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"O Trivy ajuda a antecipar problemas de configura\xe7\xe3o antes que virem riscos em produ\xe7\xe3o, tornando seu pipeline de IaC mais robusto e seguro."})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>s,x:()=>t});var a=o(6540);const n={},i=a.createContext(n);function s(e){const r=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),a.createElement(i.Provider,{value:r},e.children)}}}]);