"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[9845],{5076:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>t,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"modulo-04-avancado/contex-exp","title":"Contextos e Express\xf5es no GitHub Actions (Fundamentos)","description":"Introdu\xe7\xe3o","source":"@site/curso-github-actions-udemy/modulo-04-avancado/03-contexto-expressoes.md","sourceDirName":"modulo-04-avancado","slug":"/modulo-04-avancado/contex-exp","permalink":"/udemy/github-actions-automacao/modulo-04-avancado/contex-exp","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"contex-exp","title":"Contextos e Express\xf5es no GitHub Actions (Fundamentos)"},"sidebar":"tutorialSidebar","previous":{"title":"Secrets & Vari\xe1veis no GitHub Actions","permalink":"/udemy/github-actions-automacao/modulo-04-avancado/secrets"},"next":{"title":"Environments e Prote\xe7\xf5es de Implanta\xe7\xe3o","permalink":"/udemy/github-actions-automacao/modulo-04-avancado/env-proc"}}');var a=o(4848),i=o(8453);const r={id:"contex-exp",title:"Contextos e Express\xf5es no GitHub Actions (Fundamentos)"},c="Contextos e Express\xf5es no GitHub Actions (Fundamentos)",t={},d=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Defini\xe7\xe3o",id:"defini\xe7\xe3o",level:2},{value:"Explica\xe7\xe3o T\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Exemplo",id:"exemplo",level:2},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"contextos-e-express\xf5es-no-github-actions-fundamentos",children:"Contextos e Express\xf5es no GitHub Actions (Fundamentos)"})}),"\n",(0,a.jsx)(s.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,a.jsx)(s.p,{children:"Antes de criar condi\xe7\xf5es, reutilizar sa\xeddas de steps ou montar estrat\xe9gias de execu\xe7\xe3o, \xe9 essencial entender dois pilares do GitHub Actions: contextos e express\xf5es. Eles determinam \u201co que est\xe1 dispon\xedvel\u201d e \u201ccomo calcular\u201d valores no YAML, permitindo escrever workflows mais claros, seguros e previs\xedveis."}),"\n",(0,a.jsx)(s.h2,{id:"defini\xe7\xe3o",children:"Defini\xe7\xe3o"}),"\n",(0,a.jsxs)(s.p,{children:["Contextos s\xe3o estruturas de dados expostas pelo GitHub Actions durante a execu\xe7\xe3o do workflow, como ",(0,a.jsx)(s.code,{children:"github"}),", ",(0,a.jsx)(s.code,{children:"env"}),", ",(0,a.jsx)(s.code,{children:"vars"}),", ",(0,a.jsx)(s.code,{children:"secrets"}),", ",(0,a.jsx)(s.code,{children:"runner"}),", ",(0,a.jsx)(s.code,{children:"steps"}),", ",(0,a.jsx)(s.code,{children:"needs"})," e ",(0,a.jsx)(s.code,{children:"matrix"}),". Eles representam \u201co que est\xe1 dispon\xedvel\u201d para consulta e decis\xe3o no pipeline."]}),"\n",(0,a.jsxs)(s.p,{children:["Express\xf5es s\xe3o trechos avaliados dentro de ",(0,a.jsx)(s.code,{children:"${{ ... }}"})," que acessam esses contextos, aplicam operadores e chamam fun\xe7\xf5es (por exemplo, ",(0,a.jsx)(s.code,{children:"hashFiles"}),", ",(0,a.jsx)(s.code,{children:"toJSON"}),", ",(0,a.jsx)(s.code,{children:"fromJSON"}),"). Elas aparecem em campos como ",(0,a.jsx)(s.code,{children:"if:"}),", ",(0,a.jsx)(s.code,{children:"env:"}),", ",(0,a.jsx)(s.code,{children:"with:"})," e tamb\xe9m dentro de strings interpoladas do YAML."]}),"\n",(0,a.jsx)(s.p,{children:"Documenta\xe7\xe3o oficial:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Contextos: ",(0,a.jsx)(s.a,{href:"https://docs.github.com/pt/actions/learn-github-actions/contexts",children:"https://docs.github.com/pt/actions/learn-github-actions/contexts"})]}),"\n",(0,a.jsxs)(s.li,{children:["Express\xf5es: ",(0,a.jsx)(s.a,{href:"https://docs.github.com/pt/actions/learn-github-actions/expressions",children:"https://docs.github.com/pt/actions/learn-github-actions/expressions"})]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o T\xe9cnica"}),"\n",(0,a.jsxs)(s.p,{children:["Voc\xea usa contextos para decidir a execu\xe7\xe3o, parametrizar a\xe7\xf5es e compor nomes. Em ",(0,a.jsx)(s.code,{children:"if:"}),", por exemplo, \xe9 comum habilitar ou ignorar um step com ",(0,a.jsx)(s.code,{children:"if: ${{ github.event_name == 'push' }}"}),". Em ",(0,a.jsx)(s.code,{children:"env:"}),", valores de ",(0,a.jsx)(s.code,{children:"vars"})," podem alimentar vari\xe1veis do step, como ",(0,a.jsx)(s.code,{children:"APP_ENV"}),". Em ",(0,a.jsx)(s.code,{children:"with:"}),", inputs de a\xe7\xf5es podem receber dados vindos de ",(0,a.jsx)(s.code,{children:"env"}),", ",(0,a.jsx)(s.code,{children:"vars"})," ou ",(0,a.jsx)(s.code,{children:"steps.outputs"}),". Strings interpoladas tamb\xe9m avaliam express\xf5es, como em ",(0,a.jsx)(s.code,{children:"name: Build (${{ matrix.os }})"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Sobre os principais contextos: ",(0,a.jsx)(s.code,{children:"github"})," exp\xf5e metadados do evento e da execu\xe7\xe3o (reposit\xf3rio, branch, SHA, ator, tipo de evento) e costuma embasar condicionais e logs. ",(0,a.jsx)(s.code,{children:"env"})," agrega vari\xe1veis de ambiente definidas no workflow, job ou step, facilitando o uso em comandos de shell. ",(0,a.jsx)(s.code,{children:"vars"})," re\xfane vari\xe1veis gerenciadas pela organiza\xe7\xe3o, reposit\xf3rio ou ambiente, ideais para valores n\xe3o sens\xedveis e version\xe1veis pela interface do GitHub. ",(0,a.jsx)(s.code,{children:"secrets"})," guarda dados confidenciais mascarados; passe-os para actions ou comandos via ",(0,a.jsx)(s.code,{children:"env"}),"/",(0,a.jsx)(s.code,{children:"with"}),", evitando qualquer impress\xe3o em logs. ",(0,a.jsx)(s.code,{children:"runner"})," informa sistema operacional e arquitetura do executor, \xfatil para mensagens e caminhos espec\xedficos. ",(0,a.jsx)(s.code,{children:"steps"})," permite acessar ",(0,a.jsx)(s.code,{children:"steps.<id>.outputs.*"})," e conclus\xf5es de steps anteriores, desde que tenham um ",(0,a.jsx)(s.code,{children:"id"})," definido. ",(0,a.jsx)(s.code,{children:"needs"})," d\xe1 acesso a sa\xeddas e conclus\xf5es de jobs dos quais o atual depende. Por fim, ",(0,a.jsx)(s.code,{children:"matrix"})," cont\xe9m os valores da combina\xe7\xe3o ativa no job com ",(0,a.jsx)(s.code,{children:"strategy.matrix"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Nem todo contexto est\xe1 dispon\xedvel em qualquer lugar do YAML. Por exemplo, ",(0,a.jsx)(s.code,{children:"secrets"})," n\xe3o \xe9 aceito em ",(0,a.jsx)(s.code,{children:"runs-on"}),", e algumas propriedades n\xe3o avaliam express\xf5es. Consulte a documenta\xe7\xe3o do campo antes de usar um contexto espec\xedfico. Evite referenciar segredos diretamente em ",(0,a.jsx)(s.code,{children:"if:"})," quando n\xe3o suportado; em vez disso, mapeie-os para ",(0,a.jsx)(s.code,{children:"env:"})," no step e consuma-os no shell sem ecoar valores. Lembre-se de que ",(0,a.jsx)(s.code,{children:"steps"})," e ",(0,a.jsx)(s.code,{children:"needs"})," dependem de ",(0,a.jsx)(s.code,{children:"id"})," e nomes corretos definidos anteriormente; um erro de digita\xe7\xe3o resulta em valores vazios. E ",(0,a.jsx)(s.code,{children:"matrix"})," s\xf3 existe dentro do job que define ",(0,a.jsx)(s.code,{children:"strategy.matrix"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Express\xf5es seguem a sintaxe ",(0,a.jsx)(s.code,{children:"${{ <express\xe3o> }}"})," e aceitam operadores l\xf3gicos e de compara\xe7\xe3o (",(0,a.jsx)(s.code,{children:"&&"}),", ",(0,a.jsx)(s.code,{children:"||"}),", ",(0,a.jsx)(s.code,{children:"=="}),", ",(0,a.jsx)(s.code,{children:"!="}),") al\xe9m de fun\xe7\xf5es \xfateis. ",(0,a.jsx)(s.code,{children:"hashFiles('**/package-lock.json')"})," gera um hash determin\xedstico para chaves de cache. ",(0,a.jsx)(s.code,{children:"toJSON(obj)"})," serializa um contexto para string JSON, excelente para depurar estruturas como ",(0,a.jsx)(s.code,{children:"matrix"})," (n\xe3o use com segredos). ",(0,a.jsx)(s.code,{children:"fromJSON(str)"})," faz o caminho inverso e permite reconstruir objetos a partir de strings \u2014 um padr\xe3o comum para montar ",(0,a.jsx)(s.code,{children:"matrix"})," dinamicamente a partir de outputs."]}),"\n",(0,a.jsx)(s.p,{children:"Boas pr\xe1ticas \xfateis:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Escreva condi\xe7\xf5es expl\xedcitas, comparando com valores concretos (por exemplo, ",(0,a.jsx)(s.code,{children:"github.ref == 'refs/heads/main'"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:["N\xe3o imprima segredos; quando indispens\xe1vel, confie no mascaramento autom\xe1tico e considere ",(0,a.jsx)(s.code,{children:"::add-mask::"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:["Use ",(0,a.jsx)(s.code,{children:"toJSON"})," apenas com dados n\xe3o sens\xedveis (como ",(0,a.jsx)(s.code,{children:"matrix"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:["D\xea nomes (",(0,a.jsx)(s.code,{children:"id"}),") claros aos steps para reutilizar ",(0,a.jsx)(s.code,{children:"steps.<id>.outputs.*"})," com seguran\xe7a."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"exemplo",children:"Exemplo"}),"\n",(0,a.jsx)(s.p,{children:"Workflow te\xf3rico (sem depend\xeancias externas), compat\xedvel com executores Linux, mostrando usos b\xe1sicos de contextos e express\xf5es:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-yaml",children:'name: Aula 17 \u2014 Contextos e Express\xf5es\non:\n  workflow_dispatch:\n  push:\n    branches: [ main ]\n\njobs:\n  info:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        os: [ubuntu-latest]\n        node: [18]\n    steps:\n      - name: Exibir metadados do evento\n        run: |\n          echo "Evento: ${{ github.event_name }}"\n          echo "Branch/Ref: ${{ github.ref }}"\n          echo "Actor: ${{ github.actor }}"\n          echo "Runner OS: ${{ runner.os }}"\n\n      - name: Definir vari\xe1vel de ambiente a partir de vars\n        env:\n          APP_ENV: ${{ vars.APP_ENV }}\n        run: |\n          echo "Ambiente l\xf3gico: ${APP_ENV:-dev}"\n\n      - id: prepara\n        name: Preparar sa\xedda de step\n        run: |\n          echo "value=ok" >> "$GITHUB_OUTPUT"\n\n      - name: Usar sa\xedda do step anterior\n        if: ${{ steps.prepara.outputs.value == \'ok\' }}\n        run: |\n          echo "Step anterior retornou \'ok\' \u2014 executando a\xe7\xe3o condicionada"\n\n      - name: Depurar matrix em JSON (sem dados sens\xedveis)\n        run: |\n          echo "Matrix: ${{ toJSON(matrix) }}"\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Este exemplo demonstra a leitura de metadados (",(0,a.jsx)(s.code,{children:"github.*"}),", ",(0,a.jsx)(s.code,{children:"runner.*"}),"), o uso de ",(0,a.jsx)(s.code,{children:"vars"})," para alimentar ",(0,a.jsx)(s.code,{children:"env"})," em um step sem expor segredos, a produ\xe7\xe3o e o consumo de sa\xeddas de steps via ",(0,a.jsx)(s.code,{children:"GITHUB_OUTPUT"}),", a aplica\xe7\xe3o de ",(0,a.jsx)(s.code,{children:"if:"})," baseada em ",(0,a.jsx)(s.code,{children:"steps.prepara.outputs.value"})," e uma depura\xe7\xe3o segura com ",(0,a.jsx)(s.code,{children:"toJSON(matrix)"}),"."]}),"\n",(0,a.jsx)(s.p,{children:"Links \xfateis (oficiais):"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Contextos: ",(0,a.jsx)(s.a,{href:"https://docs.github.com/pt/actions/learn-github-actions/contexts",children:"https://docs.github.com/pt/actions/learn-github-actions/contexts"})]}),"\n",(0,a.jsxs)(s.li,{children:["Express\xf5es e fun\xe7\xf5es: ",(0,a.jsx)(s.a,{href:"https://docs.github.com/pt/actions/learn-github-actions/expressions",children:"https://docs.github.com/pt/actions/learn-github-actions/expressions"})]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,a.jsx)(s.p,{children:"Contextos revelam \u201co que\u201d est\xe1 dispon\xedvel em cada ponto do workflow, enquanto express\xf5es determinam \u201ccomo\u201d combinar e avaliar essas informa\xe7\xf5es. Dominar ambos permite criar condi\xe7\xf5es corretas, encadear sa\xeddas entre steps e jobs e depurar com rapidez. Consulte a documenta\xe7\xe3o de cada campo para confirmar disponibilidade, trate segredos com rigor e prefira express\xf5es claras e test\xe1veis para manter workflows previs\xedveis e seguros."})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,s,o)=>{o.d(s,{R:()=>r,x:()=>c});var n=o(6540);const a={},i=n.createContext(a);function r(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);