"use strict";(globalThis.webpackChunkdevops_automation_site=globalThis.webpackChunkdevops_automation_site||[]).push([[6457],{5738:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"foreach-count","title":"Aula 5 - Criando Recursos em Lote com count e for_each","description":"---","source":"@site/curso-terraform-udemy/06-foreach-count.md","sourceDirName":".","slug":"/foreach-count","permalink":"/udemy/terraform-automacao/foreach-count","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"foreach-count","title":"Aula 5 - Criando Recursos em Lote com count e for_each","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Aula 4 - Tipos de Vari\xe1veis no Terraform","permalink":"/udemy/terraform-automacao/tipos-variaveis"},"next":{"title":"Aula 6 - Mantendo a Qualidade do C\xf3digo com fmt, validate e show","permalink":"/udemy/terraform-automacao/fmt-validate-show"}}');var s=o(4848),a=o(8453);const c={id:"foreach-count",title:"Aula 5 - Criando Recursos em Lote com count e for_each",noindex:!0},i="Aula 5: Criando Recursos em Lote com count e for_each",d={},l=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que s\xe3o count e for_each?",id:"o-que-s\xe3o-count-e-for_each",level:2},{value:"Explica\xe7\xe3o T\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"count",id:"count",level:3},{value:"for_each",id:"for_each",level:3},{value:"Comandos de Refer\xeancia",id:"comandos-de-refer\xeancia",level:2},{value:"Exemplo Pr\xe1tico com for_each",id:"exemplo-pr\xe1tico-com-for_each",level:2},{value:"variables.tf",id:"variablestf",level:3},{value:"main.tf",id:"maintf",level:3},{value:"Output Esperado",id:"output-esperado",level:2},{value:"<code>terraform plan</code>",id:"terraform-plan",level:3},{value:"<code>terraform apply</code>",id:"terraform-apply",level:3},{value:"Melhores Pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2}];function t(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"aula-5-criando-recursos-em-lote-com-count-e-for_each",children:"Aula 5: Criando Recursos em Lote com count e for_each"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,s.jsxs)(r.p,{children:["Repetir blocos de c\xf3digo para criar v\xe1rios recursos \xe9 ineficiente e propenso a erros. O Terraform resolve isso com dois recursos poderosos: ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"count"})})," e ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"for_each"})}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Essas estruturas permitem criar ",(0,s.jsx)(r.strong,{children:"v\xe1rias inst\xe2ncias de um recurso automaticamente"}),", com menos c\xf3digo e mais controle."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"o-que-s\xe3o-count-e-for_each",children:"O que s\xe3o count e for_each?"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"count"}),": permite criar um n\xfamero fixo de c\xf3pias id\xeanticas de um recurso."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"for_each"}),": permite iterar sobre listas ou mapas, criando recursos personalizados com base nos valores."]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["O ",(0,s.jsx)(r.code,{children:"for_each"})," \xe9 geralmente mais flex\xedvel e recomendado."]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o T\xe9cnica"}),"\n",(0,s.jsx)(r.h3,{id:"count",children:"count"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Recebe um n\xfamero inteiro."}),"\n",(0,s.jsxs)(r.li,{children:["Gera recursos com base em um \xedndice num\xe9rico (",(0,s.jsx)(r.code,{children:"count.index"}),")."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-hcl",children:'resource "azurerm_resource_group" "rg" {\n  count    = 3\n  name     = "rg-${count.index}"\n  location = "East US"\n}\n'})}),"\n",(0,s.jsx)(r.h3,{id:"for_each",children:"for_each"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Itera sobre listas ou mapas (convertidos em ",(0,s.jsx)(r.code,{children:"set"})," ou ",(0,s.jsx)(r.code,{children:"map"}),")."]}),"\n",(0,s.jsxs)(r.li,{children:["Usa ",(0,s.jsx)(r.code,{children:"each.key"})," e ",(0,s.jsx)(r.code,{children:"each.value"})," dentro do bloco para acessar os dados."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-hcl",children:'variable "nomes_dos_grupos" {\n  type    = list(string)\n  default = ["dev", "staging", "prod"]\n}\n\nresource "azurerm_resource_group" "grupos" {\n  for_each = toset(var.nomes_dos_grupos)\n\n  name     = "rg-${each.key}"\n  location = "East US"\n}\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"comandos-de-refer\xeancia",children:"Comandos de Refer\xeancia"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform plan\nterraform apply\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"exemplo-pr\xe1tico-com-for_each",children:"Exemplo Pr\xe1tico com for_each"}),"\n",(0,s.jsx)(r.h3,{id:"variablestf",children:"variables.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-hcl",children:'variable "nomes_dos_grupos" {\n  type    = list(string)\n  default = ["dev", "staging", "prod"]\n}\n'})}),"\n",(0,s.jsx)(r.h3,{id:"maintf",children:"main.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-hcl",children:'provider "azurerm" {\n  features {}\n}\n\nresource "azurerm_resource_group" "grupos" {\n  for_each = toset(var.nomes_dos_grupos)\n\n  name     = "rg-${each.key}"\n  location = "East US"\n}\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"output-esperado",children:"Output Esperado"}),"\n",(0,s.jsx)(r.h3,{id:"terraform-plan",children:(0,s.jsx)(r.code,{children:"terraform plan"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-text",children:'Terraform will perform the following actions:\n\n  # azurerm_resource_group.grupos["dev"] will be created\n  + name = "rg-dev"\n\n  # azurerm_resource_group.grupos["staging"] will be created\n  + name = "rg-staging"\n\n  # azurerm_resource_group.grupos["prod"] will be created\n  + name = "rg-prod"\n\nPlan: 3 to add, 0 to change, 0 to destroy.\n'})}),"\n",(0,s.jsx)(r.h3,{id:"terraform-apply",children:(0,s.jsx)(r.code,{children:"terraform apply"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-text",children:"Apply complete! Resources: 3 added, 0 changed, 0 destroyed.\n"})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"melhores-pr\xe1ticas",children:"Melhores Pr\xe1ticas"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Prefira ",(0,s.jsx)(r.code,{children:"for_each"})," quando os dados forem mais complexos ou se precisar de nomes personalizados"]}),"\n",(0,s.jsxs)(r.li,{children:["Use ",(0,s.jsx)(r.code,{children:"toset()"})," ao aplicar ",(0,s.jsx)(r.code,{children:"for_each"})," a listas"]}),"\n",(0,s.jsxs)(r.li,{children:["N\xe3o altere a ordem de itens em listas se estiver usando ",(0,s.jsx)(r.code,{children:"count"})," \u2014 isso pode causar destrui\xe7\xe3o e recria\xe7\xe3o de recursos"]}),"\n",(0,s.jsxs)(r.li,{children:["Use ",(0,s.jsx)(r.code,{children:"map"})," com ",(0,s.jsx)(r.code,{children:"for_each"})," quando quiser mais controle sobre ",(0,s.jsx)(r.code,{children:"each.key"})," e ",(0,s.jsx)(r.code,{children:"each.value"})]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsxs)(r.p,{children:["Com ",(0,s.jsx)(r.code,{children:"count"})," e ",(0,s.jsx)(r.code,{children:"for_each"}),", voc\xea ganha poder e flexibilidade para criar estruturas repetidas sem repetir c\xf3digo. Ideal para ambientes grandes ou din\xe2micos!"]})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>c,x:()=>i});var n=o(6540);const s={},a=n.createContext(s);function c(e){const r=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);