"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[8122],{5154:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"14-rego","title":"Lab 12 - Introdu\xe7\xe3o \xe0 Linguagem Rego","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/32-linguagem-rego.md","sourceDirName":".","slug":"/14-rego","permalink":"/udemy/terraform-automacao/14-rego","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":32,"frontMatter":{"id":"14-rego","title":"Lab 12 - Introdu\xe7\xe3o \xe0 Linguagem Rego","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 12 - Usando OPA com Conftest no Terraform","permalink":"/udemy/terraform-automacao/13-opa-confest"},"next":{"title":"Lab 11 - Impedindo Inst\xe2ncias Caras com OPA/Conftest no Terraform","permalink":"/udemy/terraform-automacao/lab-15-confest-opa"}}');var r=n(4848),s=n(8453);const i={id:"14-rego",title:"Lab 12 - Introdu\xe7\xe3o \xe0 Linguagem Rego",noindex:!0},l="Introdu\xe7\xe3o \xe0 Linguagem Rego",d={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9 a linguagem Rego",id:"o-que-\xe9-a-linguagem-rego",level:2},{value:"Explica\xe7\xe3o t\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Benef\xedcios da Rego",id:"benef\xedcios-da-rego",level:2},{value:"Onde aplicar Rego",id:"onde-aplicar-rego",level:2},{value:"Quando usar Rego na m\xe1quina local",id:"quando-usar-rego-na-m\xe1quina-local",level:2},{value:"Quando usar Rego na pipeline",id:"quando-usar-rego-na-pipeline",level:2},{value:"Exemplo (te\xf3rico)",id:"exemplo-te\xf3rico",level:2},{value:"Output esperado",id:"output-esperado",level:2},{value:"Melhores pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function t(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"introdu\xe7\xe3o-\xe0-linguagem-rego",children:"Introdu\xe7\xe3o \xe0 Linguagem Rego"})}),"\n",(0,r.jsx)(a.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,r.jsxs)(a.p,{children:["A linguagem ",(0,r.jsx)(a.strong,{children:"Rego"})," \xe9 o cora\xe7\xe3o do Open Policy Agent (OPA), projetada para trabalhar com documentos estruturados como JSON. Inspirada em ",(0,r.jsx)(a.strong,{children:"Datalog"}),", Rego foi desenvolvida para definir pol\xedticas de forma clara, concisa e segura. Ao usar Rego, voc\xea pode inspecionar e transformar dados estruturados para garantir que suas configura\xe7\xf5es estejam em conformidade com regras organizacionais."]}),"\n",(0,r.jsxs)(a.p,{children:["Rego \xe9 uma linguagem ",(0,r.jsx)(a.strong,{children:"declarativa"}),", ou seja, voc\xea define o que espera como resultado, e n\xe3o como chegar at\xe9 ele. Isso facilita a leitura e manuten\xe7\xe3o das pol\xedticas, reduzindo erros e ambiguidades."]}),"\n",(0,r.jsx)(a.h2,{id:"o-que-\xe9-a-linguagem-rego",children:"O que \xe9 a linguagem Rego"}),"\n",(0,r.jsxs)(a.p,{children:["Rego \xe9 usada para criar ",(0,r.jsx)(a.strong,{children:"consultas sobre dados armazenados no OPA"}),", permitindo definir pol\xedticas que enumeram condi\xe7\xf5es esperadas ou proibidas. \xc9 especialmente \xfatil para raciocinar sobre planos de execu\xe7\xe3o do Terraform, defini\xe7\xf5es do Kubernetes, configura\xe7\xf5es de API gateways e outros documentos estruturados."]}),"\n",(0,r.jsx)(a.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o t\xe9cnica"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Rego \xe9 baseada em express\xf5es l\xf3gicas"}),"\n",(0,r.jsx)(a.li,{children:"Trabalha com dados aninhados e estruturas JSON complexas"}),"\n",(0,r.jsx)(a.li,{children:"Define regras como afirma\xe7\xf5es l\xf3gicas com condi\xe7\xf5es que retornam valores, mensagens ou flags"}),"\n",(0,r.jsx)(a.li,{children:"Pode retornar listas, booleanos, mensagens explicativas, etc."}),"\n",(0,r.jsx)(a.li,{children:"Suporta opera\xe7\xf5es l\xf3gicas, condicionais, la\xe7os, conjuntos e arrays"}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"benef\xedcios-da-rego",children:"Benef\xedcios da Rego"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"F\xe1cil de escrever e ler"}),": regras claras, curtas e diretas"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Declarativa"}),': foca no "o qu\xea", n\xe3o no "como"']}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Audit\xe1vel"}),": pol\xedticas como c\xf3digo, versionadas e revis\xe1veis"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Otimizada"}),": o OPA pode melhorar a performance das consultas"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Reutiliz\xe1vel"}),": regras podem ser usadas em diferentes sistemas"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"onde-aplicar-rego",children:"Onde aplicar Rego"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Localmente"}),": para testar e validar regras antes de comitar"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"No CI/CD"}),": para validar pull requests e planos de execu\xe7\xe3o"]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Em sistemas de autentica\xe7\xe3o e API gateways"}),": para tomar decis\xf5es de acesso"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"quando-usar-rego-na-m\xe1quina-local",children:"Quando usar Rego na m\xe1quina local"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Durante o desenvolvimento de regras"}),"\n",(0,r.jsx)(a.li,{children:"Para valida\xe7\xe3o de configura\xe7\xf5es antes do push"}),"\n",(0,r.jsx)(a.li,{children:"Para testes manuais de regras espec\xedficas com o playground online"}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"quando-usar-rego-na-pipeline",children:"Quando usar Rego na pipeline"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["Validar ",(0,r.jsx)(a.code,{children:"plan.json"})," do Terraform antes do apply"]}),"\n",(0,r.jsx)(a.li,{children:"Bloquear merges com configura\xe7\xf5es n\xe3o conformes"}),"\n",(0,r.jsx)(a.li,{children:"Rodar valida\xe7\xf5es em ambientes de staging e produ\xe7\xe3o"}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"exemplo-te\xf3rico",children:"Exemplo (te\xf3rico)"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-rego",children:'package seguran\xe7a\n\ndeny[msg] {\n  input.resource_changes[_].change.after.associate_public_ip_address == true\n  msg = "IP p\xfablico n\xe3o permitido."\n}\n'})}),"\n",(0,r.jsx)(a.p,{children:"Essa regra percorre os recursos do plano do Terraform e retorna uma mensagem caso encontre inst\xe2ncias com IP p\xfablico habilitado."}),"\n",(0,r.jsx)(a.h2,{id:"output-esperado",children:"Output esperado"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'+----------------------------------------+\n| data.seguranca.deny                   |\n+----------------------------------------+\n| [{"msg": "IP p\xfablico n\xe3o permitido."}] |\n+----------------------------------------+\n'})}),"\n",(0,r.jsx)(a.h2,{id:"melhores-pr\xe1ticas",children:"Melhores pr\xe1ticas"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Escreva regras simples e com uma responsabilidade clara"}),"\n",(0,r.jsx)(a.li,{children:"Use nomes descritivos para pacotes e vari\xe1veis"}),"\n",(0,r.jsx)(a.li,{children:"Comente regras complexas para facilitar entendimento"}),"\n",(0,r.jsx)(a.li,{children:"Agrupe regras por contexto (ex: rede, seguran\xe7a, custo)"}),"\n",(0,r.jsxs)(a.li,{children:["Escreva testes para suas regras com ",(0,r.jsx)(a.code,{children:"opa test"})]}),"\n",(0,r.jsxs)(a.li,{children:["Use o ",(0,r.jsx)(a.a,{href:"https://play.openpolicyagent.org",children:"OPA Playground"})," para testar e compartilhar exemplos"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,r.jsxs)(a.p,{children:["A linguagem Rego \xe9 um pilar fundamental na implementa\xe7\xe3o de ",(0,r.jsx)(a.strong,{children:"Policy as Code"}),". Aprender seus conceitos permite automatizar valida\xe7\xf5es e garantir conformidade desde o desenvolvimento, promovendo seguran\xe7a, governan\xe7a e efici\xeancia em projetos com Terraform e outras tecnologias."]})]})}function u(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>i,x:()=>l});var o=n(6540);const r={},s=o.createContext(r);function i(e){const a=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:a},e.children)}}}]);