"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[2121],{5882:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"20-intro-kevault","title":"Lab 20 - Introdu\xe7\xe3o ao Azure Key Vault","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/38-vault-microsoft.md","sourceDirName":".","slug":"/20-intro-kevault","permalink":"/udemy/terraform-automacao/20-intro-kevault","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":38,"frontMatter":{"id":"20-intro-kevault","title":"Lab 20 - Introdu\xe7\xe3o ao Azure Key Vault","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 19 - Trabalhando com Dados Sens\xedveis no Terraform","permalink":"/udemy/terraform-automacao/19-dados-sensiveis"},"next":{"title":"Lab 21 - Criando uma M\xe1quina Virtual no Azure com senha armazenada no Key Vault usando Terraform","permalink":"/udemy/terraform-automacao/21-criar-vm-kevault"}}');var o=r(4848),s=r(8453);const i={id:"20-intro-kevault",title:"Lab 20 - Introdu\xe7\xe3o ao Azure Key Vault",noindex:!0},t="Criando uma M\xe1quina Virtual no Azure com senha armazenada no Key Vault usando Terraform",d={},l=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9",id:"o-que-\xe9",level:2},{value:"Explica\xe7\xe3o t\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Comandos principais",id:"comandos-principais",level:2},{value:"Estrutura de arquivos",id:"estrutura-de-arquivos",level:2},{value:"<code>main.tf</code>",id:"maintf",level:3},{value:"<code>variables.tf</code>",id:"variablestf",level:3},{value:"<code>outputs.tf</code>",id:"outputstf",level:3},{value:"<code>terraform.tfvars</code>",id:"terraformtfvars",level:3},{value:"Exemplo de arquivos",id:"exemplo-de-arquivos",level:2},{value:"<code>variables.tf</code>",id:"variablestf-1",level:3},{value:"<code>terraform.tfvars</code>",id:"terraformtfvars-1",level:3},{value:"<code>outputs.tf</code>",id:"outputstf-1",level:3},{value:"Output esperado (simulado)",id:"output-esperado-simulado",level:2},{value:"Boas pr\xe1ticas",id:"boas-pr\xe1ticas",level:2}];function c(e){const a={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.header,{children:(0,o.jsx)(a.h1,{id:"criando-uma-m\xe1quina-virtual-no-azure-com-senha-armazenada-no-key-vault-usando-terraform",children:"Criando uma M\xe1quina Virtual no Azure com senha armazenada no Key Vault usando Terraform"})}),"\n",(0,o.jsx)(a.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,o.jsxs)(a.p,{children:["Ao trabalhar com infraestrutura como c\xf3digo, \xe9 essencial adotar boas pr\xe1ticas de seguran\xe7a desde o in\xedcio. Um erro comum \xe9 definir senhas diretamente no c\xf3digo, o que pode expor informa\xe7\xf5es sens\xedveis. Neste laborat\xf3rio, vamos aprender como provisionar uma ",(0,o.jsx)(a.strong,{children:"m\xe1quina virtual Linux no Azure"})," usando o Terraform, com a senha de administrador armazenada de forma segura no ",(0,o.jsx)(a.strong,{children:"Azure Key Vault"}),"."]}),"\n",(0,o.jsx)(a.h2,{id:"o-que-\xe9",children:"O que \xe9"}),"\n",(0,o.jsxs)(a.p,{children:["Esse lab demonstra como usar o ",(0,o.jsx)(a.strong,{children:"Azure Key Vault"})," em conjunto com o Terraform para proteger credenciais. Em vez de definir uma senha em texto plano no c\xf3digo, o segredo ser\xe1 armazenado no Key Vault, e o Terraform ir\xe1 consult\xe1-lo dinamicamente durante o provisionamento da VM."]}),"\n",(0,o.jsx)(a.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o t\xe9cnica"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["O ",(0,o.jsx)(a.strong,{children:"Key Vault"})," \xe9 criado previamente e cont\xe9m um segredo com a senha do administrador."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["O Terraform ir\xe1 utilizar um ",(0,o.jsx)(a.strong,{children:"data source"})," para buscar esse segredo."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["A senha \xe9 passada para o recurso ",(0,o.jsx)(a.code,{children:"azurerm_linux_virtual_machine"})," como par\xe2metro."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"A infraestrutura ser\xe1 composta por:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"Resource Group"}),"\n",(0,o.jsx)(a.li,{children:"Network"}),"\n",(0,o.jsx)(a.li,{children:"Network Interface"}),"\n",(0,o.jsx)(a.li,{children:"Virtual Machine"}),"\n",(0,o.jsx)(a.li,{children:"Key Vault com segredo"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(a.h2,{id:"comandos-principais",children:"Comandos principais"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"terraform init\nterraform plan -out tfplan\nterraform apply tfplan\n"})}),"\n",(0,o.jsx)(a.h2,{id:"estrutura-de-arquivos",children:"Estrutura de arquivos"}),"\n",(0,o.jsx)(a.h3,{id:"maintf",children:(0,o.jsx)(a.code,{children:"main.tf"})}),"\n",(0,o.jsx)(a.p,{children:"Cont\xe9m os recursos principais: VM, rede e acesso ao segredo no Key Vault."}),"\n",(0,o.jsx)(a.h3,{id:"variablestf",children:(0,o.jsx)(a.code,{children:"variables.tf"})}),"\n",(0,o.jsx)(a.p,{children:"Define vari\xe1veis como nomes, localiza\xe7\xe3o, tamanho da VM e nome do segredo."}),"\n",(0,o.jsx)(a.h3,{id:"outputstf",children:(0,o.jsx)(a.code,{children:"outputs.tf"})}),"\n",(0,o.jsx)(a.p,{children:"Retorna informa\xe7\xf5es \xfateis como IP p\xfablico da VM."}),"\n",(0,o.jsx)(a.h3,{id:"terraformtfvars",children:(0,o.jsx)(a.code,{children:"terraform.tfvars"})}),"\n",(0,o.jsx)(a.p,{children:"Fornece valores reais para as vari\xe1veis."}),"\n",(0,o.jsx)(a.h2,{id:"exemplo-de-arquivos",children:"Exemplo de arquivos"}),"\n",(0,o.jsx)(a.h3,{id:"variablestf-1",children:(0,o.jsx)(a.code,{children:"variables.tf"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-hcl",children:'variable "location" {\n  type    = string\n  default = "eastus"\n}\n\nvariable "resource_group_name" {\n  type = string\n}\n\nvariable "vm_admin_username" {\n  type = string\n}\n\nvariable "key_vault_name" {\n  type = string\n}\n\nvariable "secret_name" {\n  type = string\n}\n'})}),"\n",(0,o.jsx)(a.h3,{id:"terraformtfvars-1",children:(0,o.jsx)(a.code,{children:"terraform.tfvars"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-hcl",children:'resource_group_name = "rg-tf-vm-keyvault"\nvm_admin_username   = "azureuser"\nkey_vault_name      = "kv-tf-lab"\nsecret_name         = "vmPassword"\n'})}),"\n",(0,o.jsx)(a.h3,{id:"outputstf-1",children:(0,o.jsx)(a.code,{children:"outputs.tf"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-hcl",children:'output "public_ip" {\n  value = azurerm_public_ip.vm_ip.ip_address\n}\n'})}),"\n",(0,o.jsx)(a.h2,{id:"output-esperado-simulado",children:"Output esperado (simulado)"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-txt",children:'Apply complete! Resources: 6 added, 0 changed, 0 destroyed.\n\nOutputs:\n\npublic_ip = "52.170.12.34"\n'})}),"\n",(0,o.jsx)(a.h2,{id:"boas-pr\xe1ticas",children:"Boas pr\xe1ticas"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:(0,o.jsx)(a.strong,{children:"Nunca armazene segredos no c\xf3digo-fonte."})}),"\n",(0,o.jsxs)(a.li,{children:["Use ",(0,o.jsx)(a.code,{children:"terraform.tfvars"})," para valores vari\xe1veis, e ",(0,o.jsx)(a.code,{children:"terraform.tfvars.example"})," para compartilhar com a equipe."]}),"\n",(0,o.jsx)(a.li,{children:"Defina o Key Vault e o segredo fora da automa\xe7\xe3o principal, como parte do provisionamento inicial do ambiente."}),"\n",(0,o.jsx)(a.li,{children:"Use Managed Identity e RBAC para acessar o Key Vault no futuro (mais avan\xe7ado)."}),"\n",(0,o.jsxs)(a.li,{children:["Fa\xe7a o versionamento dos seus arquivos Terraform e use ",(0,o.jsx)(a.code,{children:"terraform plan"})," sempre antes de aplicar."]}),"\n"]}),"\n",(0,o.jsx)(a.hr,{}),"\n",(0,o.jsx)(a.p,{children:"Esse cen\xe1rio refor\xe7a a import\xe2ncia da seguran\xe7a desde o in\xedcio. Na pr\xf3xima aula, vamos explorar como aplicar esse padr\xe3o em ambientes mais complexos com m\xfaltiplos servi\xe7os integrados."})]})}function u(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,o.jsx)(a,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,a,r)=>{r.d(a,{R:()=>i,x:()=>t});var n=r(6540);const o={},s=n.createContext(o);function i(e){const a=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(s.Provider,{value:a},e.children)}}}]);