"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[1009],{5614:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>u,contentTitle:()=>t,default:()=>l,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"lab-6-data","title":"Lab 6 - Criando uma M\xe1quina Virtual no Azure com uso de bloco `data`","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/24-lab-data.md","sourceDirName":".","slug":"/lab-6-data","permalink":"/udemy/terraform-automacao/lab-6-data","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"id":"lab-6-data","title":"Lab 6 - Criando uma M\xe1quina Virtual no Azure com uso de bloco `data`","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 5 - Utilizando Backend Remoto com Azure Blob Storage no Terraform","permalink":"/udemy/terraform-automacao/lab-5-tfstate-remoto"},"next":{"title":"Lab 7 - Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes","permalink":"/udemy/terraform-automacao/lab-7-tfvars"}}');var o=a(4848),i=a(8453);const s={id:"lab-6-data",title:"Lab 6 - Criando uma M\xe1quina Virtual no Azure com uso de bloco `data`",noindex:!0},t="Lab: Criando uma M\xe1quina Virtual no Azure com uso de bloco data",u={},d=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Etapas Iniciais",id:"etapas-iniciais",level:2},{value:"Criar Resource Group com Azure CLI",id:"criar-resource-group-com-azure-cli",level:2},{value:"Arquivo: provider.tf",id:"arquivo-providertf",level:2},{value:"Arquivo: variables.tf",id:"arquivo-variablestf",level:2},{value:"Arquivo: main.tf",id:"arquivo-maintf",level:2},{value:"Arquivo: outputs.tf",id:"arquivo-outputstf",level:2},{value:"Comandos Terraform",id:"comandos-terraform",level:2},{value:"Resultado Esperado",id:"resultado-esperado",level:2},{value:"Dicas e Boas Pr\xe1ticas",id:"dicas-e-boas-pr\xe1ticas",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsxs)(r.h1,{id:"lab-criando-uma-m\xe1quina-virtual-no-azure-com-uso-de-bloco-data",children:["Lab: Criando uma M\xe1quina Virtual no Azure com uso de bloco ",(0,o.jsx)(r.code,{children:"data"})]})}),"\n",(0,o.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,o.jsxs)(r.p,{children:["Este laborat\xf3rio demonstra como criar uma m\xe1quina virtual Linux no Azure usando Terraform 1.12.2, aproveitando recursos j\xe1 existentes atrav\xe9s do uso do bloco ",(0,o.jsx)(r.code,{children:"data"}),". O grupo de recursos ser\xe1 criado via Azure CLI, e suas informa\xe7\xf5es acessadas com ",(0,o.jsx)(r.code,{children:"data.azurerm_resource_group"}),". Todos os demais recursos (VNet, Subnet, IP p\xfablico, NIC e VM) ser\xe3o criados via Terraform."]}),"\n",(0,o.jsx)(r.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Terraform 1.12.2 instalado"}),"\n",(0,o.jsxs)(r.li,{children:["Conta Azure configurada com ",(0,o.jsx)(r.code,{children:"az login"})]}),"\n",(0,o.jsx)(r.li,{children:"Grupo de recursos existente criado com Azure CLI"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'export ARM_SUBSCRIPTION_ID="subscription_id"\n'})}),"\n",(0,o.jsx)(r.h2,{id:"etapas-iniciais",children:"Etapas Iniciais"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"Crie um diret\xf3rio para seu projeto:"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"mkdir lab-vm-azure && cd lab-vm-azure\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"Crie os arquivos conforme a estrutura abaixo:"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"touch main.tf variables.tf outputs.tf provider.tf\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"3",children:["\n",(0,o.jsx)(r.li,{children:"Verifique a estrutura do diret\xf3rio:"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"tree\n"})}),"\n",(0,o.jsx)(r.p,{children:"Sa\xedda esperada:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"lab-vm-azure/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 provider.tf\n"})}),"\n",(0,o.jsx)(r.h2,{id:"criar-resource-group-com-azure-cli",children:"Criar Resource Group com Azure CLI"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"az group create --name devops-automation-rg --location eastus\n"})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-providertf",children:"Arquivo: provider.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'provider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-variablestf",children:"Arquivo: variables.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'variable "admin_username" {\n  description = "Nome de usu\xe1rio para login na VM"\n  default     = "azureuser"\n}\n\nvariable "admin_password" {\n  description = "Senha para login na VM"\n  sensitive   = true\n  default     = "SenhaForte123!"\n}\n\nvariable "location" {\n  description = "Localiza\xe7\xe3o dos recursos"\n  default     = "eastus"\n}\n\nvariable "resource_group_name" {\n  description = "Nome do Resource Group j\xe1 existente"\n  default     = "devops-automation-rg"\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-maintf",children:"Arquivo: main.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'data "azurerm_resource_group" "rg" {\n  name = var.resource_group_name\n}\n\nresource "azurerm_virtual_network" "vnet" {\n  name                = "devopsautomation-vnet"\n  address_space       = ["10.0.0.0/16"]\n  location            = data.azurerm_resource_group.rg.location\n  resource_group_name = data.azurerm_resource_group.rg.name\n}\n\nresource "azurerm_subnet" "subnet" {\n  name                 = "devopsautomation-subnet"\n  resource_group_name  = data.azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = ["10.0.1.0/24"]\n}\n\nresource "azurerm_public_ip" "public_ip" {\n  name                = "devopsautomation-public-ip"\n  location            = data.azurerm_resource_group.rg.location\n  resource_group_name = data.azurerm_resource_group.rg.name\n  allocation_method   = "Static"\n  sku                 = "Standard"\n}\n\nresource "azurerm_network_interface" "nic" {\n  name                = "devopsautomation-nic"\n  location            = data.azurerm_resource_group.rg.location\n  resource_group_name = data.azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = "internal"\n    subnet_id                     = azurerm_subnet.subnet.id\n    private_ip_address_allocation = "Dynamic"\n    public_ip_address_id          = azurerm_public_ip.public_ip.id\n  }\n}\n\nresource "azurerm_linux_virtual_machine" "vm" {\n  name                = "devopsautomation-vm"\n  location            = data.azurerm_resource_group.rg.location\n  resource_group_name = data.azurerm_resource_group.rg.name\n  size                = "Standard_B1s"\n  admin_username      = var.admin_username\n  admin_password      = var.admin_password\n  disable_password_authentication = false\n\n  network_interface_ids = [azurerm_network_interface.nic.id]\n\n  os_disk {\n    name                 = "devopsautomation-osdisk"\n    caching              = "ReadWrite"\n    storage_account_type = "Standard_LRS"\n  }\n\n  source_image_reference {\n    publisher = "Canonical"\n    offer     = "UbuntuServer"\n    sku       = "18.04-LTS"\n    version   = "latest"\n  }\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-outputstf",children:"Arquivo: outputs.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'output "vm_name" {\n  value = azurerm_linux_virtual_machine.vm.name\n}\n\noutput "public_ip" {\n  value = azurerm_public_ip.public_ip.ip_address\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"comandos-terraform",children:"Comandos Terraform"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"terraform init    # Inicializa o diret\xf3rio e baixa plugins\nterraform plan    # Mostra o plano de execu\xe7\xe3o com os recursos que ser\xe3o criados\nterraform apply   # Aplica o plano e cria os recursos\n"})}),"\n",(0,o.jsx)(r.h2,{id:"resultado-esperado",children:"Resultado Esperado"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"M\xe1quina virtual criada"}),"\n",(0,o.jsx)(r.li,{children:"IP p\xfablico atribu\xeddo"}),"\n",(0,o.jsx)(r.li,{children:"Interface de rede conectada"}),"\n",(0,o.jsx)(r.li,{children:"VNet e Subnet criadas"}),"\n",(0,o.jsx)(r.li,{children:"Nome e IP exibidos como sa\xedda"}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"dicas-e-boas-pr\xe1ticas",children:"Dicas e Boas Pr\xe1ticas"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Use vari\xe1veis para tudo que pode mudar entre ambientes"}),"\n",(0,o.jsxs)(r.li,{children:["Evite hardcode de nomes ou IDs \u2014 sempre que poss\xedvel, use ",(0,o.jsx)(r.code,{children:"data"})]}),"\n",(0,o.jsx)(r.li,{children:"Separe os arquivos para melhor organiza\xe7\xe3o"}),"\n",(0,o.jsxs)(r.li,{children:["Proteja senhas usando ",(0,o.jsx)(r.code,{children:"sensitive = true"})]}),"\n",(0,o.jsxs)(r.li,{children:["Adicione ",(0,o.jsx)(r.code,{children:".gitignore"})," para evitar versionamento de arquivos sens\xedveis"]}),"\n"]})]})}function l(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,r,a)=>{a.d(r,{R:()=>s,x:()=>t});var n=a(6540);const o={},i=n.createContext(o);function s(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);