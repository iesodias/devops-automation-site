"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[3688],{2440:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"17-modulos-teoria","title":"Lab 17 - M\xf3dulos no Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/35-modulo-terraform-vm.md","sourceDirName":".","slug":"/17-modulos-teoria","permalink":"/udemy/terraform-automacao/17-modulos-teoria","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":35,"frontMatter":{"id":"17-modulos-teoria","title":"Lab 17 - M\xf3dulos no Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 16 - Aplicando Pol\xedticas OPA/Conftest para Storage Account no Azure","permalink":"/udemy/terraform-automacao/lab-16-confest-opa"},"next":{"title":"Lab 18 - Criando uma M\xe1quina Virtual no Azure com M\xf3dulo Terraform","permalink":"/udemy/terraform-automacao/lab-18-modulos"}}');var n=o(4848),i=o(8453);const d={id:"17-modulos-teoria",title:"Lab 17 - M\xf3dulos no Terraform",noindex:!0},a="M\xf3dulos no Terraform",l={},t=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que s\xe3o M\xf3dulos no Terraform",id:"o-que-s\xe3o-m\xf3dulos-no-terraform",level:2},{value:"Explica\xe7\xe3o T\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Como funciona:",id:"como-funciona",level:3},{value:"Como referenciar um m\xf3dulo:",id:"como-referenciar-um-m\xf3dulo",level:3},{value:"Fontes v\xe1lidas para <code>source</code>:",id:"fontes-v\xe1lidas-para-source",level:3},{value:"Benef\xedcios dos M\xf3dulos",id:"benef\xedcios-dos-m\xf3dulos",level:2},{value:"Quando usar M\xf3dulos",id:"quando-usar-m\xf3dulos",level:2},{value:"Quando rodar localmente vs pipeline",id:"quando-rodar-localmente-vs-pipeline",level:2},{value:"Exemplo simples",id:"exemplo-simples",level:2},{value:"Output esperado",id:"output-esperado",level:2},{value:"Melhores pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function c(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"m\xf3dulos-no-terraform",children:"M\xf3dulos no Terraform"})}),"\n",(0,n.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(r.p,{children:["Conforme os projetos de infraestrutura crescem, manter arquivos ",(0,n.jsx)(r.code,{children:"main.tf"})," com centenas de linhas se torna insustent\xe1vel. Para resolver isso, o Terraform introduz o conceito de ",(0,n.jsx)(r.strong,{children:"m\xf3dulos"}),", que permitem reutilizar e organizar recursos em blocos reutiliz\xe1veis e independentes."]}),"\n",(0,n.jsx)(r.p,{children:"Nesta p\xe1gina, vamos entender profundamente como os m\xf3dulos funcionam, seus benef\xedcios, estrutura, quando utilizar, como aplicar localmente e em pipelines, al\xe9m de pr\xe1ticas recomendadas para projetos profissionais."}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"o-que-s\xe3o-m\xf3dulos-no-terraform",children:"O que s\xe3o M\xf3dulos no Terraform"}),"\n",(0,n.jsxs)(r.p,{children:["Um ",(0,n.jsx)(r.strong,{children:"m\xf3dulo"})," no Terraform \xe9 qualquer conjunto de arquivos ",(0,n.jsx)(r.code,{children:".tf"})," em um diret\xf3rio. O pr\xf3prio diret\xf3rio onde voc\xea escreve seu ",(0,n.jsx)(r.code,{children:"main.tf"})," principal j\xe1 \xe9 um m\xf3dulo impl\xedcito."]}),"\n",(0,n.jsxs)(r.p,{children:["No entanto, ao separar partes da infraestrutura (como rede, m\xe1quinas virtuais, storage, etc.) em diret\xf3rios pr\xf3prios e reutiliz\xe1veis, voc\xea cria ",(0,n.jsx)(r.strong,{children:"m\xf3dulos expl\xedcitos"}),". Isso melhora a manutenibilidade, padroniza\xe7\xe3o e facilita o versionamento."]}),"\n",(0,n.jsx)(r.p,{children:"Voc\xea pode:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Usar ",(0,n.jsx)(r.strong,{children:"m\xf3dulos locais"})," (na mesma estrutura do projeto)"]}),"\n",(0,n.jsxs)(r.li,{children:["Usar ",(0,n.jsx)(r.strong,{children:"m\xf3dulos remotos"})," (de um reposit\xf3rio Git, Registry oficial ou privado)"]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o T\xe9cnica"}),"\n",(0,n.jsx)(r.h3,{id:"como-funciona",children:"Como funciona:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Cada m\xf3dulo recebe ",(0,n.jsx)(r.strong,{children:"entradas"})," (",(0,n.jsx)(r.code,{children:"variables.tf"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Executa recursos (",(0,n.jsx)(r.code,{children:"main.tf"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Exp\xf5e ",(0,n.jsx)(r.strong,{children:"sa\xeddas"})," (",(0,n.jsx)(r.code,{children:"outputs.tf"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Pode ter ",(0,n.jsx)(r.strong,{children:"depend\xeancias entre m\xf3dulos"})," com ",(0,n.jsx)(r.code,{children:"depends_on"})]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"como-referenciar-um-m\xf3dulo",children:"Como referenciar um m\xf3dulo:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'module "nome" {\n  source = "./modules/nome-do-modulo"\n  variavel1 = "valor"\n  variavel2 = 123\n}\n'})}),"\n",(0,n.jsxs)(r.p,{children:["O Terraform copia o conte\xfado do m\xf3dulo referenciado durante o ",(0,n.jsx)(r.code,{children:"init"}),", processa as vari\xe1veis e cria os recursos como se estivessem no ",(0,n.jsx)(r.code,{children:"main.tf"}),"."]}),"\n",(0,n.jsxs)(r.h3,{id:"fontes-v\xe1lidas-para-source",children:["Fontes v\xe1lidas para ",(0,n.jsx)(r.code,{children:"source"}),":"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Caminho local: ",(0,n.jsx)(r.code,{children:"./modules/vm"})]}),"\n",(0,n.jsxs)(r.li,{children:["Reposit\xf3rio Git: ",(0,n.jsx)(r.code,{children:"git::https://github.com/org/modulo.git"})]}),"\n",(0,n.jsxs)(r.li,{children:["Terraform Registry: ",(0,n.jsx)(r.code,{children:"terraform-azure-modules/network/azurerm"})]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"benef\xedcios-dos-m\xf3dulos",children:"Benef\xedcios dos M\xf3dulos"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Reutiliza\xe7\xe3o de c\xf3digo"}),": escreva uma vez, use em v\xe1rios projetos"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Organiza\xe7\xe3o"}),": separa\xe7\xe3o l\xf3gica por dom\xednio (rede, VM, seguran\xe7a...)"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Padroniza\xe7\xe3o"}),": evita que cada equipe implemente do seu jeito"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Versionamento"}),": m\xf3dulos podem ter vers\xf5es fixas em Git ou Registry"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Testabilidade"}),": facilita testes de componentes isolados"]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"quando-usar-m\xf3dulos",children:"Quando usar M\xf3dulos"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Sempre que houver ",(0,n.jsx)(r.strong,{children:"repeti\xe7\xe3o de recursos"})," (ex: v\xe1rias VMs com padr\xf5es)"]}),"\n",(0,n.jsxs)(r.li,{children:["Em ",(0,n.jsx)(r.strong,{children:"ambientes distintos"})," (dev, hml, prod)"]}),"\n",(0,n.jsxs)(r.li,{children:["Quando for construir ",(0,n.jsx)(r.strong,{children:"infraestrutura reutiliz\xe1vel por outras squads"})]}),"\n",(0,n.jsx)(r.li,{children:"Para separar responsabilidades entre times (ex: time de rede vs time de apps)"}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"quando-rodar-localmente-vs-pipeline",children:"Quando rodar localmente vs pipeline"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Etapa"}),(0,n.jsx)(r.th,{children:"Localmente"}),(0,n.jsx)(r.th,{children:"Na pipeline CI/CD"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Desenvolvimento inicial"}),(0,n.jsx)(r.td,{children:"\u2705 Cria\xe7\xe3o/teste dos m\xf3dulos"}),(0,n.jsx)(r.td,{children:"\u26a0\ufe0f Apenas revis\xe3o da estrutura"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Valida\xe7\xe3o sintaxe"}),(0,n.jsxs)(r.td,{children:["\u2705 ",(0,n.jsx)(r.code,{children:"terraform validate"})]}),(0,n.jsx)(r.td,{children:"\u2705 Automatizado no CI"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Execu\xe7\xe3o de testes (OPA/Checkov)"}),(0,n.jsx)(r.td,{children:"\u2705 Teste local com dados fict\xedcios"}),(0,n.jsxs)(r.td,{children:["\u2705 Autom\xe1tico com ",(0,n.jsx)(r.code,{children:"plan.json"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsxs)(r.td,{children:["Execu\xe7\xe3o real (",(0,n.jsx)(r.code,{children:"apply"}),")"]}),(0,n.jsx)(r.td,{children:"\u274c Evitar aplicar direto localmente"}),(0,n.jsx)(r.td,{children:"\u2705 Aprovado via PR/CI com pol\xedtica"})]})]})]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"exemplo-simples",children:"Exemplo simples"}),"\n",(0,n.jsx)(r.p,{children:"Estrutura:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"infra/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 terraform.tfvars\n\u2514\u2500\u2500 modules/\n    \u2514\u2500\u2500 vm/\n        \u251c\u2500\u2500 main.tf\n        \u251c\u2500\u2500 variables.tf\n        \u2514\u2500\u2500 outputs.tf\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.code,{children:"infra/main.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'module "vm" {\n  source = "./modules/vm"\n  nome   = "vm-dev"\n  imagem = "UbuntuServer"\n  tamanho = "Standard_B1s"\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.code,{children:"modules/vm/main.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'resource "azurerm_linux_virtual_machine" "vm" {\n  name     = var.nome\n  size     = var.tamanho\n  ...\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.code,{children:"modules/vm/variables.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'variable "nome" {\n  type = string\n}\n\nvariable "imagem" {\n  type = string\n}\n\nvariable "tamanho" {\n  type = string\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.code,{children:"modules/vm/outputs.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'output "vm_name" {\n  value = azurerm_linux_virtual_machine.vm.name\n}\n'})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"output-esperado",children:"Output esperado"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'Apply complete! Resources: 1 added.\n\nOutputs:\nvm_name = "vm-dev"\n'})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"melhores-pr\xe1ticas",children:"Melhores pr\xe1ticas"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Sempre use ",(0,n.jsx)(r.code,{children:"variables.tf"}),", ",(0,n.jsx)(r.code,{children:"outputs.tf"})," e ",(0,n.jsx)(r.code,{children:"README.md"})," dentro dos m\xf3dulos"]}),"\n",(0,n.jsxs)(r.li,{children:["Separe m\xf3dulos reutiliz\xe1veis por dom\xednio (ex: ",(0,n.jsx)(r.code,{children:"vm"}),", ",(0,n.jsx)(r.code,{children:"network"}),", ",(0,n.jsx)(r.code,{children:"app"}),")"]}),"\n",(0,n.jsxs)(r.li,{children:["Utilize ",(0,n.jsx)(r.code,{children:"terraform-docs"})," para gerar documenta\xe7\xf5es autom\xe1ticas dos m\xf3dulos"]}),"\n",(0,n.jsxs)(r.li,{children:["Nomeie vari\xe1veis com clareza e padroniza\xe7\xe3o (",(0,n.jsx)(r.code,{children:"prefixo_vm"}),", ",(0,n.jsx)(r.code,{children:"env"}),", etc.)"]}),"\n",(0,n.jsx)(r.li,{children:"Mantenha os m\xf3dulos versionados em Git ou Registry privado"}),"\n",(0,n.jsxs)(r.li,{children:["Prefira m\xf3dulos ",(0,n.jsx)(r.strong,{children:"puros"}),", sem l\xf3gica de ambiente dentro deles"]}),"\n",(0,n.jsxs)(r.li,{children:["Evite ",(0,n.jsx)(r.strong,{children:"m\xf3dulos acoplados"})," com muitos recursos juntos"]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,n.jsx)(r.p,{children:"O uso de m\xf3dulos em Terraform \xe9 essencial para escalar projetos de infraestrutura com qualidade, padroniza\xe7\xe3o e governan\xe7a. Al\xe9m de reduzir erros humanos, m\xf3dulos promovem reutiliza\xe7\xe3o, isolamento e clareza na estrutura do c\xf3digo."}),"\n",(0,n.jsx)(r.p,{children:"A ado\xe7\xe3o correta de m\xf3dulos desde o in\xedcio facilita o crescimento do projeto e torna a esteira de DevOps mais robusta e confi\xe1vel."})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>d,x:()=>a});var s=o(6540);const n={},i=s.createContext(n);function d(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);