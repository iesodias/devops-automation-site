"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[3420],{7627:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"lab-7-tfvars","title":"Lab 7 - Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/25-lab-tfvars.md","sourceDirName":".","slug":"/lab-7-tfvars","permalink":"/udemy/terraform-automacao/lab-7-tfvars","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"id":"lab-7-tfvars","title":"Lab 7 - Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 6 - Criando uma M\xe1quina Virtual no Azure com uso de bloco `data`","permalink":"/udemy/terraform-automacao/lab-6-data"},"next":{"title":"Aula 11 - Introdu\xe7\xe3o ao Shift Left Security e SAST com Terraform","permalink":"/udemy/terraform-automacao/trivy-teorico"}}');var o=a(4848),s=a(8453);const t={id:"lab-7-tfvars",title:"Lab 7 - Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes",noindex:!0},i="Lab: Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes",l={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Etapas Iniciais",id:"etapas-iniciais",level:2},{value:"Arquivo: provider.tf",id:"arquivo-providertf",level:2},{value:"Arquivo: variables.tf",id:"arquivo-variablestf",level:2},{value:"Arquivo: main.tf",id:"arquivo-maintf",level:2},{value:"Arquivo: outputs.tf",id:"arquivo-outputstf",level:2},{value:"Arquivo: envs/dev/dev.tfvars",id:"arquivo-envsdevdevtfvars",level:2},{value:"Arquivo: envs/hml/hml.tfvars",id:"arquivo-envshmlhmltfvars",level:2},{value:"Arquivo: envs/prod/prod.tfvars",id:"arquivo-envsprodprodtfvars",level:2},{value:"Comandos Terraform",id:"comandos-terraform",level:2},{value:"Resultado Esperado",id:"resultado-esperado",level:2},{value:"Dicas e Boas Pr\xe1ticas",id:"dicas-e-boas-pr\xe1ticas",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"lab-criando-uma-storage-account-no-azure-com-uso-de-tfvars-para-m\xfaltiplos-ambientes",children:"Lab: Criando uma Storage Account no Azure com uso de .tfvars para m\xfaltiplos ambientes"})}),"\n",(0,o.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,o.jsxs)(r.p,{children:["Neste laborat\xf3rio, vamos criar uma Storage Account no Azure usando Terraform 1.12.2 com separa\xe7\xe3o de arquivos e defini\xe7\xe3o de vari\xe1veis via arquivos ",(0,o.jsx)(r.code,{children:".tfvars"})," para tr\xeas ambientes distintos: desenvolvimento (",(0,o.jsx)(r.code,{children:"dev"}),"), homologa\xe7\xe3o (",(0,o.jsx)(r.code,{children:"hml"}),") e produ\xe7\xe3o (",(0,o.jsx)(r.code,{children:"prod"}),")."]}),"\n",(0,o.jsx)(r.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Terraform 1.12.2 instalado"}),"\n",(0,o.jsxs)(r.li,{children:["Conta Azure autenticada com ",(0,o.jsx)(r.code,{children:"az login"})]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"etapas-iniciais",children:"Etapas Iniciais"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsx)(r.li,{children:"Crie a estrutura de diret\xf3rios e arquivos:"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"mkdir -p lab-storage-account/envs/{dev,hml,prod} && cd lab-storage-account\n\ntouch main.tf variables.tf outputs.tf provider.tf\n\ntouch envs/dev/dev.tfvars\n\ntouch envs/hml/hml.tfvars\n\ntouch envs/prod/prod.tfvars\n"})}),"\n",(0,o.jsxs)(r.ol,{start:"2",children:["\n",(0,o.jsx)(r.li,{children:"Verifique a estrutura com:"}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"tree\n"})}),"\n",(0,o.jsx)(r.p,{children:"Sa\xedda esperada:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"lab-storage-account/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 provider.tf\n\u251c\u2500\u2500 variables.tf\n\u2514\u2500\u2500 envs\n    \u251c\u2500\u2500 dev\n    \u2502   \u2514\u2500\u2500 dev.tfvars\n    \u251c\u2500\u2500 hml\n    \u2502   \u2514\u2500\u2500 hml.tfvars\n    \u2514\u2500\u2500 prod\n        \u2514\u2500\u2500 prod.tfvars\n"})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-providertf",children:"Arquivo: provider.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'provider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-variablestf",children:"Arquivo: variables.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'variable "location" {\n  description = "Localiza\xe7\xe3o dos recursos"\n  type        = string\n}\n\nvariable "resource_group_name" {\n  description = "Nome do Resource Group"\n  type        = string\n}\n\nvariable "storage_account_name" {\n  description = "Nome da Storage Account"\n  type        = string\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-maintf",children:"Arquivo: main.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'resource "azurerm_resource_group" "rg" {\n  name     = var.resource_group_name\n  location = var.location\n}\n\nresource "azurerm_storage_account" "storage" {\n  name                     = var.storage_account_name\n  resource_group_name      = azurerm_resource_group.rg.name\n  location                 = azurerm_resource_group.rg.location\n  account_tier             = "Standard"\n  account_replication_type = "LRS"\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-outputstf",children:"Arquivo: outputs.tf"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-terraform",children:'output "storage_account_name" {\n  value = azurerm_storage_account.storage.name\n}\n\noutput "resource_group_name" {\n  value = azurerm_resource_group.rg.name\n}\n\noutput "location" {\n  value = azurerm_storage_account.storage.location\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-envsdevdevtfvars",children:"Arquivo: envs/dev/dev.tfvars"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'location             = "eastus"\nresource_group_name  = "dev-storage-rg"\nstorage_account_name = "storagedev123"\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-envshmlhmltfvars",children:"Arquivo: envs/hml/hml.tfvars"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'location             = "centralus"\nresource_group_name  = "hml-storage-rg"\nstorage_account_name = "storagehml123"\n'})}),"\n",(0,o.jsx)(r.h2,{id:"arquivo-envsprodprodtfvars",children:"Arquivo: envs/prod/prod.tfvars"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'location             = "westeurope"\nresource_group_name  = "prod-storage-rg"\nstorage_account_name = "storageprd123"\n'})}),"\n",(0,o.jsx)(r.h2,{id:"comandos-terraform",children:"Comandos Terraform"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'terraform init\n\nterraform plan -var-file="envs/dev/dev.tfvars"\nterraform apply -var-file="envs/dev/dev.tfvars"\n\nterraform plan -var-file="envs/hml/hml.tfvars"\nterraform apply -var-file="envs/hml/hml.tfvars"\n\nterraform plan -var-file="envs/prod/prod.tfvars"\nterraform apply -var-file="envs/prod/prod.tfvars"\n'})}),"\n",(0,o.jsx)(r.h2,{id:"resultado-esperado",children:"Resultado Esperado"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Um Resource Group e uma Storage Account criados para o ambiente selecionado"}),"\n",(0,o.jsx)(r.li,{children:"Outputs mostrando nome da storage, RG e localiza\xe7\xe3o"}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"dicas-e-boas-pr\xe1ticas",children:"Dicas e Boas Pr\xe1ticas"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Nunca comite arquivos ",(0,o.jsx)(r.code,{children:".tfvars"})," com dados sens\xedveis"]}),"\n",(0,o.jsx)(r.li,{children:"Use nomes claros e consistentes para os arquivos de vari\xe1veis por ambiente"}),"\n",(0,o.jsx)(r.li,{children:"Separe l\xf3gica (infraestrutura) de configura\xe7\xe3o (valores por ambiente)"}),"\n",(0,o.jsxs)(r.li,{children:["Padronize nomes dos recursos para refletirem o ambiente (ex: ",(0,o.jsx)(r.code,{children:"storageprd123"}),")"]}),"\n",(0,o.jsx)(r.li,{children:"Utilize pastas para organiza\xe7\xe3o e facilidade em pipelines"}),"\n"]}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.p,{children:"Este lab permite testar e reaproveitar o mesmo c\xf3digo Terraform em diferentes ambientes com seguran\xe7a e organiza\xe7\xe3o."})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,r,a)=>{a.d(r,{R:()=>t,x:()=>i});var n=a(6540);const o={},s=n.createContext(o);function t(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);