"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[4123],{8453:(e,r,o)=>{o.d(r,{R:()=>d,x:()=>i});var n=o(6540);const a={},s=n.createContext(a);function d(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),n.createElement(s.Provider,{value:r},e.children)}},9677:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>d,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"lab-3-for-each-count","title":"Lab 3 - Criando Recursos em Lote com count e for_each no Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/11-lab-for-each-count.md","sourceDirName":".","slug":"/lab-3-for-each-count","permalink":"/udemy/terraform-automacao/lab-3-for-each-count","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"id":"lab-3-for-each-count","title":"Lab 3 - Criando Recursos em Lote com count e for_each no Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab - Vari\xe1veis e Outputs no Terraform","permalink":"/udemy/terraform-automacao/lab-2-variables-output"},"next":{"title":"Lab 4 - Mantendo a Qualidade do C\xf3digo com fmt, validate e show no Terraform","permalink":"/udemy/terraform-automacao/lab-4-fmt-validate"}}');var a=o(4848),s=o(8453);const d={id:"lab-3-for-each-count",title:"Lab 3 - Criando Recursos em Lote com count e for_each no Terraform",noindex:!0},i="Lab: Criando Recursos em Lote com count e for_each no Terraform",c={},t=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Estrutura de Arquivos",id:"estrutura-de-arquivos",level:2},{value:"<code>providers.tf</code>",id:"providerstf",level:2},{value:"<code>variables.tf</code>",id:"variablestf",level:2},{value:"<code>main.tf</code>",id:"maintf",level:2},{value:"Comandos",id:"comandos",level:2},{value:"Resultado Esperado",id:"resultado-esperado",level:2},{value:"Estrutura de Arquivos",id:"estrutura-de-arquivos-1",level:2},{value:"<code>variables.tf</code>",id:"variablestf-1",level:2},{value:"<code>main.tf</code>",id:"maintf-1",level:2},{value:"<code>providers.tf</code>",id:"providerstf-1",level:2},{value:"Comandos",id:"comandos-1",level:2},{value:"Resultado Esperado",id:"resultado-esperado-1",level:2},{value:"Boas Pr\xe1ticas",id:"boas-pr\xe1ticas",level:2}];function l(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"lab-criando-recursos-em-lote-com-count-e-for_each-no-terraform",children:"Lab: Criando Recursos em Lote com count e for_each no Terraform"})}),"\n",(0,a.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,a.jsxs)(r.p,{children:["Neste laborat\xf3rio, vamos aprender a criar m\xfaltiplos recursos automaticamente usando ",(0,a.jsx)(r.code,{children:"count"})," e ",(0,a.jsx)(r.code,{children:"for_each"}),", dois recursos poderosos do Terraform. Vamos aplicar isso na cria\xe7\xe3o de m\xfaltiplos resource groups na Azure."]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsxs)(r.h1,{id:"parte-1-criando-resource-groups-com-count",children:["Parte 1: Criando Resource Groups com ",(0,a.jsx)(r.code,{children:"count"})]}),"\n",(0,a.jsx)(r.h2,{id:"estrutura-de-arquivos",children:"Estrutura de Arquivos"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"lab-count-resource-groups/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 providers.tf\n"})}),"\n",(0,a.jsx)(r.h2,{id:"providerstf",children:(0,a.jsx)(r.code,{children:"providers.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'terraform {\n  required_providers {\n    azurerm = {\n      source  = "hashicorp/azurerm"\n      version = "4.35.0"\n    }\n  }\n\n  required_version = ">= 1.12.2"\n}\n\nprovider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"variablestf",children:(0,a.jsx)(r.code,{children:"variables.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'variable "quantidade_de_grupos" {\n  type    = number\n  default = 3\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"maintf",children:(0,a.jsx)(r.code,{children:"main.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'resource "azurerm_resource_group" "rg" {\n  count    = var.quantidade_de_grupos\n  name     = "rg-count-${count.index}"\n  location = "East US"\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"comandos",children:"Comandos"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform plan\nterraform apply\n"})}),"\n",(0,a.jsx)(r.h2,{id:"resultado-esperado",children:"Resultado Esperado"}),"\n",(0,a.jsx)(r.p,{children:"Cria\xe7\xe3o de 3 resource groups com nomes:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"rg-count-0"}),"\n",(0,a.jsx)(r.li,{children:"rg-count-1"}),"\n",(0,a.jsx)(r.li,{children:"rg-count-2"}),"\n"]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["\u26a0\ufe0f O uso do ",(0,a.jsx)(r.code,{children:"count"})," \xe9 ideal quando queremos v\xe1rias c\xf3pias id\xeanticas de um recurso."]}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsxs)(r.h1,{id:"parte-2-criando-resource-groups-com-for_each",children:["Parte 2: Criando Resource Groups com ",(0,a.jsx)(r.code,{children:"for_each"})]}),"\n",(0,a.jsx)(r.h2,{id:"estrutura-de-arquivos-1",children:"Estrutura de Arquivos"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"lab-foreach-resource-groups/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 providers.tf\n"})}),"\n",(0,a.jsx)(r.h2,{id:"variablestf-1",children:(0,a.jsx)(r.code,{children:"variables.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'variable "nomes_dos_grupos" {\n  type    = list(string)\n  default = ["dev", "staging", "prod"]\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"maintf-1",children:(0,a.jsx)(r.code,{children:"main.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'resource "azurerm_resource_group" "rg" {\n  for_each = toset(var.nomes_dos_grupos)\n\n  name     = "rg-${each.key}"\n  location = "East US"\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"providerstf-1",children:(0,a.jsx)(r.code,{children:"providers.tf"})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-terraform",children:'terraform {\n  required_providers {\n    azurerm = {\n      source  = "hashicorp/azurerm"\n      version = "4.35.0"\n    }\n  }\n\n  required_version = ">= 1.12.2"\n}\n\nprovider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,a.jsx)(r.h2,{id:"comandos-1",children:"Comandos"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform plan\nterraform apply\n"})}),"\n",(0,a.jsx)(r.h2,{id:"resultado-esperado-1",children:"Resultado Esperado"}),"\n",(0,a.jsx)(r.p,{children:"Cria\xe7\xe3o de 3 resource groups com nomes:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"rg-dev"}),"\n",(0,a.jsx)(r.li,{children:"rg-staging"}),"\n",(0,a.jsx)(r.li,{children:"rg-prod"}),"\n"]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["\u2705 O ",(0,a.jsx)(r.code,{children:"for_each"})," \xe9 mais flex\xedvel, ideal para dados nomeados e quando os recursos n\xe3o s\xe3o id\xeanticos."]}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"boas-pr\xe1ticas",children:"Boas Pr\xe1ticas"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Prefira ",(0,a.jsx)(r.code,{children:"for_each"})," quando for trabalhar com listas nomeadas ou mapas"]}),"\n",(0,a.jsxs)(r.li,{children:["Use ",(0,a.jsx)(r.code,{children:"count"})," apenas quando todos os recursos forem realmente id\xeanticos"]}),"\n",(0,a.jsxs)(r.li,{children:["Evite alterar a ordem de listas com ",(0,a.jsx)(r.code,{children:"count"})," para n\xe3o destruir e recriar recursos acidentalmente"]}),"\n",(0,a.jsxs)(r.li,{children:["Sempre use ",(0,a.jsx)(r.code,{children:"terraform plan"})," para visualizar as mudan\xe7as antes de aplicar"]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);