"use strict";(globalThis.webpackChunkdevops_automation_site=globalThis.webpackChunkdevops_automation_site||[]).push([[1514],{950:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"tutorial-terraform/terraform-checkov-azure","title":"Como Validar Infraestrutura no Azure com Checkov e Terraform (Passo a Passo 2025)","description":"Aprenda a utilizar o Checkov para validar sua infraestrutura como c\xf3digo no Azure com Terraform. Detecte falhas de seguran\xe7a antes do deploy e crie ambientes mais seguros com an\xe1lise est\xe1tica. Tutorial completo em portugu\xeas para DevOps!","source":"@site/docs/tutorial-terraform/02-terraform-checkov-azure.md","sourceDirName":"tutorial-terraform","slug":"/tutorial-terraform/terraform-checkov-azure","permalink":"/docs/tutorial-terraform/terraform-checkov-azure","draft":false,"unlisted":false,"editUrl":"https://github.com/iesodias/devops-automation-site/tree/main/docs/tutorial-terraform/02-terraform-checkov-azure.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Como Validar Infraestrutura no Azure com Checkov e Terraform (Passo a Passo 2025)","description":"Aprenda a utilizar o Checkov para validar sua infraestrutura como c\xf3digo no Azure com Terraform. Detecte falhas de seguran\xe7a antes do deploy e crie ambientes mais seguros com an\xe1lise est\xe1tica. Tutorial completo em portugu\xeas para DevOps!","keywords":["checkov terraform azure","checkov validar infraestrutura azure","terraform azure seguran\xe7a infraestrutura","checkov terraform pt-br","infraestrutura como codigo segura","checkov azure tutorial","checkov terraform an\xe1lise est\xe1tica"]},"sidebar":"tutorialSidebar","previous":{"title":"Como Criar um Site Est\xe1tico na Azure Usando Terraform (Passo a Passo 2025)","permalink":"/docs/tutorial-terraform/terraform-website-azure"},"next":{"title":"Tutorial - Github","permalink":"/docs/category/tutorial---github"}}');var o=a(4848),i=a(8453);const s={sidebar_position:1,title:"Como Validar Infraestrutura no Azure com Checkov e Terraform (Passo a Passo 2025)",description:"Aprenda a utilizar o Checkov para validar sua infraestrutura como c\xf3digo no Azure com Terraform. Detecte falhas de seguran\xe7a antes do deploy e crie ambientes mais seguros com an\xe1lise est\xe1tica. Tutorial completo em portugu\xeas para DevOps!",keywords:["checkov terraform azure","checkov validar infraestrutura azure","terraform azure seguran\xe7a infraestrutura","checkov terraform pt-br","infraestrutura como codigo segura","checkov azure tutorial","checkov terraform an\xe1lise est\xe1tica"]},t=void 0,c={},u=[{value:"Requisitos",id:"requisitos",level:3},{value:"Estrutura do Lab",id:"estrutura-do-lab",level:3},{value:"C\xf3digo Terraform (main.tf)",id:"c\xf3digo-terraform-maintf",level:3},{value:"Executando o Terraform",id:"executando-o-terraform",level:3},{value:"Validando com o Checkov",id:"validando-com-o-checkov",level:3},{value:"Criando o .checkov.yaml para ignorar regras",id:"criando-o-checkovyaml-para-ignorar-regras",level:3},{value:"Limpeza do ambiente (opcional)",id:"limpeza-do-ambiente-opcional",level:3},{value:"Refer\xeancias",id:"refer\xeancias",level:3}];function l(e){const r={a:"a",code:"code",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.p,{children:"Este tutorial demonstra como utilizar o Checkov para validar configura\xe7\xf5es inseguras em uma infraestrutura criada com Terraform no Azure."}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"requisitos",children:"Requisitos"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Conta no Azure"}),"\n",(0,o.jsx)(r.li,{children:"Terraform instalado"}),"\n",(0,o.jsx)(r.li,{children:"Python instalado (se for instalar o Checkov via pip)"}),"\n",(0,o.jsx)(r.li,{children:"Checkov instalado:"}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Via pip:"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"pip install checkov\n"})}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.strong,{children:"Via Docker:"})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"docker run -t -v $(pwd):/tf bridgecrew/checkov -d /tf\n"})}),"\n",(0,o.jsx)(r.h3,{id:"estrutura-do-lab",children:"Estrutura do Lab"}),"\n",(0,o.jsx)(r.p,{children:"Vamos provisionar:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"1 Resource Group"}),"\n",(0,o.jsx)(r.li,{children:"1 Virtual Network + Subnet"}),"\n",(0,o.jsx)(r.li,{children:"1 NSG com a porta 22 aberta (SSH)"}),"\n",(0,o.jsx)(r.li,{children:"1 Network Interface"}),"\n",(0,o.jsx)(r.li,{children:"1 Linux Virtual Machine com senha habilitada (sem SSH key)"}),"\n"]}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"c\xf3digo-terraform-maintf",children:"C\xf3digo Terraform (main.tf)"}),"\n",(0,o.jsxs)(r.p,{children:["Crie um arquivo chamado ",(0,o.jsx)(r.code,{children:"main.tf"})," com o seguinte conte\xfado:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'provider "azurerm" {\n  features {}\n}\n\nterraform {\n  required_providers {\n    azurerm = {\n      source  = "hashicorp/azurerm"\n      version = ">= 3.0.0"\n    }\n  }\n}\n\nresource "azurerm_resource_group" "rg" {\n  name     = "rg-checkov-vm"\n  location = "eastus"\n}\n\nresource "azurerm_virtual_network" "vnet" {\n  name                = "vnet-checkov"\n  address_space       = ["10.0.0.0/16"]\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource "azurerm_subnet" "subnet" {\n  name                 = "subnet-checkov"\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = ["10.0.1.0/24"]\n}\n\nresource "azurerm_network_security_group" "nsg" {\n  name                = "nsg-checkov"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  security_rule {\n    name                       = "AllowSSH"\n    priority                   = 1001\n    direction                  = "Inbound"\n    access                     = "Allow"\n    protocol                   = "Tcp"\n    source_port_range          = "*"\n    destination_port_range     = "22"\n    source_address_prefix      = "*"\n    destination_address_prefix = "*"\n  }\n}\n\nresource "azurerm_network_interface" "nic" {\n  name                = "nic-checkov"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = "internal"\n    subnet_id                     = azurerm_subnet.subnet.id\n    private_ip_address_allocation = "Dynamic"\n  }\n}\n\nresource "azurerm_linux_virtual_machine" "vm" {\n  name                = "vm-checkov"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = "Standard_B1s"\n  admin_username      = "azureuser"\n  network_interface_ids = [\n    azurerm_network_interface.nic.id,\n  ]\n\n  admin_password = "P@ssword1234!" # <- m\xe1 pr\xe1tica proposital\n\n  disable_password_authentication = false\n\n  os_disk {\n    name              = "disk-checkov"\n    caching           = "ReadWrite"\n    storage_account_type = "Standard_LRS"\n  }\n\n  source_image_reference {\n    publisher = "Canonical"\n    offer     = "UbuntuServer"\n    sku       = "18.04-LTS"\n    version   = "latest"\n  }\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"executando-o-terraform",children:"Executando o Terraform"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform apply -auto-approve\n"})}),"\n",(0,o.jsx)(r.h3,{id:"validando-com-o-checkov",children:"Validando com o Checkov"}),"\n",(0,o.jsxs)(r.p,{children:["Rode o Checkov no diret\xf3rio com seu ",(0,o.jsx)(r.code,{children:"main.tf"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"checkov -d .\n"})}),"\n",(0,o.jsx)(r.p,{children:"O Checkov ir\xe1 identificar v\xe1rias falhas, como:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"SSH liberado para qualquer IP"}),"\n",(0,o.jsx)(r.li,{children:"Uso de senha na VM"}),"\n",(0,o.jsx)(r.li,{children:"Falta de NSG associada \xe0 subnet"}),"\n",(0,o.jsx)(r.li,{children:"Aus\xeancia de autentica\xe7\xe3o por chave"}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"criando-o-checkovyaml-para-ignorar-regras",children:"Criando o .checkov.yaml para ignorar regras"}),"\n",(0,o.jsxs)(r.p,{children:["Para ignorar algumas falhas intencionais do lab, crie um arquivo chamado ",(0,o.jsx)(r.code,{children:".checkov.yaml"})," com o seguinte conte\xfado:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-yaml",children:"skip_checks:\n  - CKV_AZURE_1\n  - CKV_AZURE_10\n  - CKV_AZURE_50\n  - CKV_AZURE_149\n  - CKV_AZURE_178\n  - CKV2_AZURE_31\n"})}),"\n",(0,o.jsx)(r.p,{children:"Rode novamente:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"checkov -d .\n"})}),"\n",(0,o.jsx)(r.h3,{id:"limpeza-do-ambiente-opcional",children:"Limpeza do ambiente (opcional)"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"terraform destroy -auto-approve\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h3,{id:"refer\xeancias",children:"Refer\xeancias"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.a,{href:"https://github.com/bridgecrewio/checkov",children:"Checkov no GitHub"})}),"\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.a,{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs",children:"Documenta\xe7\xe3o da Azure Provider"})}),"\n"]})]})}function d(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,r,a)=>{a.d(r,{R:()=>s,x:()=>t});var n=a(6540);const o={},i=n.createContext(o);function s(e){const r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);