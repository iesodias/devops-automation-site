"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[4267],{1877:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"backend-remote","title":"Aula 7 - O Perigo do terraform.tfstate e a Solu\xe7\xe3o do Backend Remoto","description":"---","source":"@site/curso-terraform-udemy/08-tfstate-remoto.md","sourceDirName":".","slug":"/backend-remote","permalink":"/udemy/terraform-automacao/backend-remote","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"backend-remote","title":"Aula 7 - O Perigo do terraform.tfstate e a Solu\xe7\xe3o do Backend Remoto","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Aula 6 - Mantendo a Qualidade do C\xf3digo com fmt, validate e show","permalink":"/udemy/terraform-automacao/fmt-validate-show"},"next":{"title":"Lab-1 - Criando um Resource Group no Azure com Terraform","permalink":"/udemy/terraform-automacao/lab-1-rg"}}');var a=r(4848),t=r(8453);const s={id:"backend-remote",title:"Aula 7 - O Perigo do terraform.tfstate e a Solu\xe7\xe3o do Backend Remoto",noindex:!0},i="Aula 7: O tfstate e Backend Remoto no Azure",d={},l=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9 o terraform.tfstate?",id:"o-que-\xe9-o-terraformtfstate",level:2},{value:"Exemplo de risco:",id:"exemplo-de-risco",level:3},{value:"Problemas do Estado Local",id:"problemas-do-estado-local",level:2},{value:"A Solu\xe7\xe3o: Backend Remoto no Azure",id:"a-solu\xe7\xe3o-backend-remoto-no-azure",level:2},{value:"Conceitos Importantes",id:"conceitos-importantes",level:2},{value:"Exemplo pr\xe1tico - backend.tf",id:"exemplo-pr\xe1tico---backendtf",level:2},{value:"Inicializa\xe7\xe3o do backend",id:"inicializa\xe7\xe3o-do-backend",level:2},{value:"Output esperado:",id:"output-esperado",level:3},{value:"terraform plan com locking",id:"terraform-plan-com-locking",level:2},{value:"Melhores Pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2}];function c(e){const o={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.header,{children:(0,a.jsx)(o.h1,{id:"aula-7-o-tfstate-e-backend-remoto-no-azure",children:"Aula 7: O tfstate e Backend Remoto no Azure"})}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,a.jsxs)(o.p,{children:["Nesta aula, vamos abordar o arquivo mais cr\xedtico do Terraform: o ",(0,a.jsx)(o.code,{children:"terraform.tfstate"}),". Ele \xe9 vital para o funcionamento da ferramenta, mas tamb\xe9m \xe9 um dos maiores riscos de seguran\xe7a quando mal gerenciado. Vamos entender o perigo do estado local e como o backend remoto no Azure resolve todos esses problemas."]}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"o-que-\xe9-o-terraformtfstate",children:"O que \xe9 o terraform.tfstate?"}),"\n",(0,a.jsxs)(o.p,{children:["O ",(0,a.jsx)(o.code,{children:"terraform.tfstate"})," \xe9 um arquivo JSON que guarda:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"O mapeamento entre seu c\xf3digo e os recursos reais criados no Azure"}),"\n",(0,a.jsx)(o.li,{children:"Metadados sobre depend\xeancias"}),"\n",(0,a.jsx)(o.li,{children:"Atributos dos recursos, incluindo dados sens\xedveis (como senhas!)"}),"\n"]}),"\n",(0,a.jsx)(o.h3,{id:"exemplo-de-risco",children:"Exemplo de risco:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-json",children:'"resources": [\n  {\n    "type": "azurerm_sql_server",\n    "name": "meu_servidor_sql",\n    "instances": [\n      {\n        "attributes": {\n          "administrator_login_password": "MinhaSenhaSuperSecreta123",\n          "fully_qualified_domain_name": "meuservidor.database.windows.net"\n        }\n      }\n    ]\n  }\n]\n'})}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"problemas-do-estado-local",children:"Problemas do Estado Local"}),"\n",(0,a.jsxs)(o.ol,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Seguran\xe7a"}),": Pode conter segredos"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Colabora\xe7\xe3o"}),": Trabalhos simult\xe2neos geram conflitos"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Perda de Dados"}),": Um simples rm -rf pode destruir tudo"]}),"\n"]}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"a-solu\xe7\xe3o-backend-remoto-no-azure",children:"A Solu\xe7\xe3o: Backend Remoto no Azure"}),"\n",(0,a.jsxs)(o.p,{children:["Armazenar o estado em um local seguro e compartilhado, como o ",(0,a.jsx)(o.strong,{children:"Azure Blob Storage"}),", traz os seguintes benef\xedcios:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Seguran\xe7a"})," com criptografia e RBAC do Azure"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Colabora\xe7\xe3o"})," com estado centralizado"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Locking"})," autom\xe1tico com leasing nativo do Blob"]}),"\n"]}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"conceitos-importantes",children:"Conceitos Importantes"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Storage Account"}),": Cont\xeainer geral de servi\xe7os de armazenamento"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Blob Storage"}),": Onde o arquivo de estado \xe9 realmente salvo"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Container"}),": Diret\xf3rio dentro do Blob Storage"]}),"\n",(0,a.jsxs)(o.li,{children:[(0,a.jsx)(o.strong,{children:"Key"}),": Caminho/nome do arquivo tfstate"]}),"\n"]}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"exemplo-pr\xe1tico---backendtf",children:"Exemplo pr\xe1tico - backend.tf"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-hcl",children:'terraform {\n  backend "azurerm" {\n    resource_group_name  = "rg-terraform-state-prod"\n    storage_account_name = "tfstateprodproject"\n    container_name       = "tfstate"\n    key                  = "meu-projeto/terraform.tfstate"\n  }\n}\n'})}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"inicializa\xe7\xe3o-do-backend",children:"Inicializa\xe7\xe3o do backend"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-bash",children:"az login\naz group create -n rg-terraform-state-prod -l eastus\naz storage account create -n tfstateprodproject -g rg-terraform-state-prod --sku Standard_LRS\naz storage container create --name tfstate --account-name tfstateprodproject\nterraform init\n"})}),"\n",(0,a.jsx)(o.h3,{id:"output-esperado",children:"Output esperado:"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-text",children:'Initializing the backend...\nSuccessfully configured the backend "azurerm"!\nTerraform will use the remote backend from now on.\n'})}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"terraform-plan-com-locking",children:"terraform plan com locking"}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-bash",children:"terraform plan\n"})}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{className:"language-text",children:"Acquiring state lock. This may take a few moments...\n...\nPlan: 1 to add, 0 to change, 0 to destroy.\n"})}),"\n",(0,a.jsx)(o.hr,{}),"\n",(0,a.jsx)(o.h2,{id:"melhores-pr\xe1ticas",children:"Melhores Pr\xe1ticas"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Nunca adicione o tfstate ao Git!"}),"\n",(0,a.jsx)(o.li,{children:"Sempre use backend remoto em times"}),"\n",(0,a.jsx)(o.li,{children:"Ative o RBAC na Storage Account"}),"\n",(0,a.jsx)(o.li,{children:"Proteja o acesso ao blob com pol\xedticas de acesso restritas"}),"\n",(0,a.jsx)(o.li,{children:"Use criptografia e monitoramento"}),"\n"]}),"\n",(0,a.jsx)(o.hr,{})]})}function m(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,a.jsx)(o,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,o,r)=>{r.d(o,{R:()=>s,x:()=>i});var n=r(6540);const a={},t=n.createContext(a);function s(e){const o=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(t.Provider,{value:o},e.children)}}}]);