"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[6792],{8176:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>i,contentTitle:()=>t,default:()=>l,frontMatter:()=>d,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"data-block","title":"Aula 8 - Bloco data no Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/14-data-block.md","sourceDirName":".","slug":"/data-block","permalink":"/udemy/terraform-automacao/data-block","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"id":"data-block","title":"Aula 8 - Bloco data no Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Aula 7 - O Perigo do terraform.tfstate e a Solu\xe7\xe3o do Backend Remoto","permalink":"/udemy/terraform-automacao/backend-remote"},"next":{"title":"Aula 8 - Arquivos .tfvars no Terraform","permalink":"/udemy/terraform-automacao/tfvars"}}');var n=o(4848),s=o(8453);const d={id:"data-block",title:"Aula 8 - Bloco data no Terraform",noindex:!0},t="Bloco data no Terraform",i={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9 o bloco <code>data</code>",id:"o-que-\xe9-o-bloco-data",level:2},{value:"Explica\xe7\xe3o t\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Comando(s) usados",id:"comandos-usados",level:2},{value:"Exemplo pr\xe1tico",id:"exemplo-pr\xe1tico",level:2},{value:"Output esperado",id:"output-esperado",level:2},{value:"Melhores pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2}];function u(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsxs)(r.h1,{id:"bloco-data-no-terraform",children:["Bloco ",(0,n.jsx)(r.code,{children:"data"})," no Terraform"]})}),"\n",(0,n.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(r.p,{children:["No Terraform, al\xe9m de criar recursos, tamb\xe9m \xe9 comum precisarmos ",(0,n.jsx)(r.strong,{children:"consultar dados existentes"})," em provedores de nuvem. Para isso, usamos o bloco ",(0,n.jsx)(r.code,{children:"data"}),". Ele permite acessar informa\xe7\xf5es que j\xe1 est\xe3o criadas, como redes virtuais, imagens, grupos de recursos, entre outros."]}),"\n",(0,n.jsx)(r.p,{children:"Este recurso \xe9 muito \xfaltil quando voc\xea quer usar elementos que j\xe1 existem no ambiente Azure, mas n\xe3o quer (ou n\xe3o pode) cri\xe1-los novamente."}),"\n",(0,n.jsxs)(r.h2,{id:"o-que-\xe9-o-bloco-data",children:["O que \xe9 o bloco ",(0,n.jsx)(r.code,{children:"data"})]}),"\n",(0,n.jsxs)(r.p,{children:["O bloco ",(0,n.jsx)(r.code,{children:"data"})," \xe9 um tipo especial de bloco no Terraform usado para ",(0,n.jsx)(r.strong,{children:"consultar dados externos"})," de um provedor. Diferente dos blocos ",(0,n.jsx)(r.code,{children:"resource"}),", que criam infraestrutura, os blocos ",(0,n.jsx)(r.code,{children:"data"})," apenas leem e importam dados para uso dentro do c\xf3digo."]}),"\n",(0,n.jsx)(r.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o t\xe9cnica"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Um ",(0,n.jsx)(r.code,{children:"data"})," precisa de dois argumentos principais: ",(0,n.jsx)(r.strong,{children:"tipo"})," e ",(0,n.jsx)(r.strong,{children:"nome do recurso"}),"."]}),"\n",(0,n.jsxs)(r.li,{children:["O conte\xfado do ",(0,n.jsx)(r.code,{children:"data"})," define os filtros e par\xe2metros para buscar o recurso."]}),"\n",(0,n.jsxs)(r.li,{children:["Depois que o dado \xe9 lido, voc\xea pode us\xe1-lo com ",(0,n.jsx)(r.code,{children:"data.<tipo>.<nome>.atributo"})]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Exemplo de sintaxe:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'data "azurerm_resource_group" "rg" {\n  name = "meu-resource-group"\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"comandos-usados",children:"Comando(s) usados"}),"\n",(0,n.jsx)(r.p,{children:"Para aplicar e visualizar dados:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"terraform init\nterraform plan\nterraform apply\n"})}),"\n",(0,n.jsx)(r.h2,{id:"exemplo-pr\xe1tico",children:"Exemplo pr\xe1tico"}),"\n",(0,n.jsxs)(r.p,{children:["Vamos usar um bloco ",(0,n.jsx)(r.code,{children:"data"})," para buscar um grupo de recursos j\xe1 existente no Azure e usar uma imagem existente da galeria para criar uma m\xe1quina virtual:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-hcl",children:'provider "azurerm" {\n  features {}\n}\n\ndata "azurerm_resource_group" "rg" {\n  name = "meu-resource-group"\n}\n\ndata "azurerm_shared_image" "ubuntu_image" {\n  name                = "UbuntuLTS"\n  gallery_name        = "MinhaGaleria"\n  resource_group_name = data.azurerm_resource_group.rg.name\n}\n\nresource "azurerm_linux_virtual_machine" "vm" {\n  name                = "vm-exemplo"\n  resource_group_name = data.azurerm_resource_group.rg.name\n  location            = data.azurerm_resource_group.rg.location\n  size                = "Standard_B1s"\n  admin_username      = "azureuser"\n\n  network_interface_ids = [\n    azurerm_network_interface.nic.id\n  ]\n\n  os_disk {\n    caching              = "ReadWrite"\n    storage_account_type = "Standard_LRS"\n    name                 = "osdisk"\n  }\n\n  source_image_id = data.azurerm_shared_image.ubuntu_image.id\n  disable_password_authentication = true\n\n  admin_ssh_key {\n    username   = "azureuser"\n    public_key = file("~/.ssh/id_rsa.pub")\n  }\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"output-esperado",children:"Output esperado"}),"\n",(0,n.jsxs)(r.p,{children:["Ao rodar ",(0,n.jsx)(r.code,{children:"terraform apply"}),", voc\xea deve ver algo como:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'Apply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nOutputs:\nazurerm_linux_virtual_machine.vm:\n  id = "/subscriptions/xxx/resourceGroups/meu-resource-group/providers/Microsoft.Compute/virtualMachines/vm-exemplo"\n  name = "vm-exemplo"\n  location = "eastus"\n  size = "Standard_B1s"\n'})}),"\n",(0,n.jsx)(r.h2,{id:"melhores-pr\xe1ticas",children:"Melhores pr\xe1ticas"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Sempre verifique os filtros usados nos blocos ",(0,n.jsx)(r.code,{children:"data"})," para evitar retornar dados errados."]}),"\n",(0,n.jsxs)(r.li,{children:["Evite hardcode de nomes e IDs \u2014 prefira referenciar com ",(0,n.jsx)(r.code,{children:"data"}),"."]}),"\n",(0,n.jsxs)(r.li,{children:["Use ",(0,n.jsx)(r.code,{children:"depends_on"})," quando o dado depender de um recurso criado em tempo de execu\xe7\xe3o."]}),"\n",(0,n.jsxs)(r.li,{children:["Documente o motivo de uso de cada bloco ",(0,n.jsx)(r.code,{children:"data"})," no c\xf3digo."]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["O uso correto do bloco ",(0,n.jsx)(r.code,{children:"data"})," com Azure permite integrar recursos existentes ao seu c\xf3digo Terraform, melhorando a reutiliza\xe7\xe3o e mantendo a infraestrutura sincronizada com o que j\xe1 est\xe1 em produ\xe7\xe3o."]})]})}function l(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>d,x:()=>t});var a=o(6540);const n={},s=a.createContext(n);function d(e){const r=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),a.createElement(s.Provider,{value:r},e.children)}}}]);