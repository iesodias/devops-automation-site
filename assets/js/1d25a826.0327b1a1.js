"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[7864],{5692:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"lab-5-tfstate-remoto","title":"Lab 5 - Utilizando Backend Remoto com Azure Blob Storage no Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/13-lab-state-remoto.md","sourceDirName":".","slug":"/lab-5-tfstate-remoto","permalink":"/udemy/terraform-automacao/lab-5-tfstate-remoto","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"id":"lab-5-tfstate-remoto","title":"Lab 5 - Utilizando Backend Remoto com Azure Blob Storage no Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 4 - Mantendo a Qualidade do C\xf3digo com fmt, validate e show no Terraform","permalink":"/udemy/terraform-automacao/lab-4-fmt-validate"}}');var n=a(4848),t=a(8453);const i={id:"lab-5-tfstate-remoto",title:"Lab 5 - Utilizando Backend Remoto com Azure Blob Storage no Terraform",noindex:!0},s="Lab: Utilizando Backend Remoto com Azure Blob Storage no Terraform",d={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Etapa 1: Criar infraestrutura de backend com Azure CLI",id:"etapa-1-criar-infraestrutura-de-backend-com-azure-cli",level:2},{value:"Etapa 2: Estrutura dos arquivos Terraform",id:"etapa-2-estrutura-dos-arquivos-terraform",level:2},{value:"<code>backend.tf</code>",id:"backendtf",level:2},{value:"<code>providers.tf</code>",id:"providerstf",level:2},{value:"<code>main.tf</code>",id:"maintf",level:2},{value:"Etapa 3: Inicializar com backend remoto",id:"etapa-3-inicializar-com-backend-remoto",level:2},{value:"Output esperado:",id:"output-esperado",level:3},{value:"Etapa 4: Executar o plano e aplicar",id:"etapa-4-executar-o-plano-e-aplicar",level:2},{value:"Output esperado:",id:"output-esperado-1",level:3},{value:"Boas Pr\xe1ticas",id:"boas-pr\xe1ticas",level:2},{value:"Limpeza do Ambiente",id:"limpeza-do-ambiente",level:2}];function l(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"lab-utilizando-backend-remoto-com-azure-blob-storage-no-terraform",children:"Lab: Utilizando Backend Remoto com Azure Blob Storage no Terraform"})}),"\n",(0,n.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(r.p,{children:["Neste laborat\xf3rio, vamos configurar o Terraform para utilizar um backend remoto no Azure, armazenando o arquivo de estado (",(0,n.jsx)(r.code,{children:"terraform.tfstate"}),") em um Blob Storage seguro. Isso \xe9 essencial para ambientes colaborativos e para proteger informa\xe7\xf5es sens\xedveis."]}),"\n",(0,n.jsx)(r.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Terraform instalado (vers\xe3o 1.12.2 ou superior)"}),"\n",(0,n.jsxs)(r.li,{children:["Azure CLI instalada e autenticada (",(0,n.jsx)(r.code,{children:"az login"}),")"]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"etapa-1-criar-infraestrutura-de-backend-com-azure-cli",children:"Etapa 1: Criar infraestrutura de backend com Azure CLI"}),"\n",(0,n.jsx)(r.p,{children:"Execute os comandos abaixo para criar os recursos necess\xe1rios:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"az login\n\naz group create -n rg-devopsautomation -l eastus\n\naz storage account create \\\n  --name labdevopsautomation \\\n  --resource-group rg-devopsautomation \\\n  --sku Standard_LRS \\\n  --encryption-services blob\n\naz storage container create \\\n  --name tfstate \\\n  --account-name labdevopsautomation \\\n  --auth-mode login\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"etapa-2-estrutura-dos-arquivos-terraform",children:"Etapa 2: Estrutura dos arquivos Terraform"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"lab-backend-remoto/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 backend.tf\n\u251c\u2500\u2500 providers.tf\n"})}),"\n",(0,n.jsx)(r.h2,{id:"backendtf",children:(0,n.jsx)(r.code,{children:"backend.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-terraform",children:'terraform {\n  backend "azurerm" {\n    resource_group_name  = "rg-devopsautomation"\n    storage_account_name = "labdevopsautomation"\n    container_name       = "tfstate"\n    key                  = "lab/resource-group.tfstate"\n  }\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"providerstf",children:(0,n.jsx)(r.code,{children:"providers.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-terraform",children:'terraform {\n  required_providers {\n    azurerm = {\n      source  = "hashicorp/azurerm"\n      version = "4.35.0"\n    }\n  }\n\n  required_version = ">= 1.12.2"\n}\n\nprovider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"maintf",children:(0,n.jsx)(r.code,{children:"main.tf"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-terraform",children:'resource "azurerm_resource_group" "rg" {\n  name     = "rg-backend-remoto"\n  location = "East US"\n}\n'})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"etapa-3-inicializar-com-backend-remoto",children:"Etapa 3: Inicializar com backend remoto"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"terraform init\n"})}),"\n",(0,n.jsx)(r.h3,{id:"output-esperado",children:"Output esperado:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-text",children:'Initializing the backend...\nSuccessfully configured the backend "azurerm"!\nTerraform will use the remote backend from now on.\n'})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"etapa-4-executar-o-plano-e-aplicar",children:"Etapa 4: Executar o plano e aplicar"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"terraform plan\nterraform apply\n"})}),"\n",(0,n.jsx)(r.h3,{id:"output-esperado-1",children:"Output esperado:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-text",children:"Acquiring state lock. This may take a few moments...\n...\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n"})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"boas-pr\xe1ticas",children:"Boas Pr\xe1ticas"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Nunca versionar o arquivo ",(0,n.jsx)(r.code,{children:"terraform.tfstate"})]}),"\n",(0,n.jsx)(r.li,{children:"Use RBAC e pol\xedticas no container de storage"}),"\n",(0,n.jsx)(r.li,{children:"Ative logging e criptografia no Azure"}),"\n",(0,n.jsxs)(r.li,{children:["Nomeie arquivos ",(0,n.jsx)(r.code,{children:"key"})," de forma clara por ambiente (ex: ",(0,n.jsx)(r.code,{children:"dev/main.tfstate"}),")"]}),"\n"]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h2,{id:"limpeza-do-ambiente",children:"Limpeza do Ambiente"}),"\n",(0,n.jsx)(r.p,{children:"Para remover o recurso criado pelo Terraform:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"terraform destroy\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["Confirme com ",(0,n.jsx)(r.code,{children:"yes"})," quando solicitado."]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Para remover a infraestrutura do backend remoto (grupo de recursos, storage account e container):"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"az group delete --name rg-devopsautomation --yes --no-wait\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"\u26a0\ufe0f Esse comando \xe9 irrevers\xedvel e excluir\xe1 todos os recursos dentro do grupo, incluindo o estado remoto."}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,r,a)=>{a.d(r,{R:()=>i,x:()=>s});var o=a(6540);const n={},t=o.createContext(n);function i(e){const r=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),o.createElement(t.Provider,{value:r},e.children)}}}]);