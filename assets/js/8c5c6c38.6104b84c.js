"use strict";(globalThis.webpackChunkdevops_automation_site=globalThis.webpackChunkdevops_automation_site||[]).push([[3264],{2283:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"lab-8-ws","title":"Lab 8 - Criando uma Storage Account no Azure usando Terraform Workspaces","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/26-lab-ws.md","sourceDirName":".","slug":"/lab-8-ws","permalink":"/udemy/terraform-automacao/lab-8-ws","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":26,"frontMatter":{"id":"lab-8-ws","title":"Lab 8 - Criando uma Storage Account no Azure usando Terraform Workspaces","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Lab 7 - Criando uma Storage Account no Azure com uso de .tfvars","permalink":"/udemy/terraform-automacao/lab-7-tfvars"},"next":{"title":"Lab 9 - Criando uma Storage Account no Azure com uso de `locals`","permalink":"/udemy/terraform-automacao/lab-9-locals"}}');var s=a(4848),n=a(8453);const i={id:"lab-8-ws",title:"Lab 8 - Criando uma Storage Account no Azure usando Terraform Workspaces",noindex:!0},t="Lab: Criando uma Storage Account no Azure usando Terraform Workspaces",c={},l=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Pr\xe9-requisitos",id:"pr\xe9-requisitos",level:2},{value:"Etapas Iniciais",id:"etapas-iniciais",level:2},{value:"Arquivo: provider.tf",id:"arquivo-providertf",level:2},{value:"Arquivo: variables.tf",id:"arquivo-variablestf",level:2},{value:"Arquivo: main.tf",id:"arquivo-maintf",level:2},{value:"Arquivo: outputs.tf",id:"arquivo-outputstf",level:2},{value:"Comandos Terraform",id:"comandos-terraform",level:2},{value:"Resultado Esperado",id:"resultado-esperado",level:2},{value:"Dicas e Boas Pr\xe1ticas",id:"dicas-e-boas-pr\xe1ticas",level:2},{value:"Destruindo os Ambientes",id:"destruindo-os-ambientes",level:2},{value:"Dicas e Boas Pr\xe1ticas",id:"dicas-e-boas-pr\xe1ticas-1",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"lab-criando-uma-storage-account-no-azure-usando-terraform-workspaces",children:"Lab: Criando uma Storage Account no Azure usando Terraform Workspaces"})}),"\n",(0,s.jsx)(r.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,s.jsxs)(r.p,{children:["Neste laborat\xf3rio, vamos criar uma Storage Account no Azure utilizando ",(0,s.jsx)(r.strong,{children:"Terraform 1.12.2"})," e ",(0,s.jsx)(r.strong,{children:"workspaces"})," para isolar ambientes (dev, hml e prod). Cada workspace ter\xe1 seu pr\xf3prio estado, permitindo reaproveitar o mesmo c\xf3digo com recursos diferentes por ambiente."]}),"\n",(0,s.jsx)(r.h2,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Terraform 1.12.2 instalado"}),"\n",(0,s.jsxs)(r.li,{children:["Conta Azure autenticada com ",(0,s.jsx)(r.code,{children:"az login"})]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'export ARM_SUBSCRIPTION_ID="subscription_id"\n'})}),"\n",(0,s.jsx)(r.h2,{id:"etapas-iniciais",children:"Etapas Iniciais"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Crie o diret\xf3rio e entre nele:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"mkdir lab-storage-ws && cd lab-storage-ws\n"})}),"\n",(0,s.jsxs)(r.ol,{start:"2",children:["\n",(0,s.jsx)(r.li,{children:"Crie os arquivos b\xe1sicos do Terraform:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"touch main.tf variables.tf outputs.tf provider.tf\n"})}),"\n",(0,s.jsxs)(r.ol,{start:"3",children:["\n",(0,s.jsx)(r.li,{children:"Estrutura esperada:"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"lab-storage-ws/\n\u251c\u2500\u2500 main.tf\n\u251c\u2500\u2500 variables.tf\n\u251c\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 provider.tf\n"})}),"\n",(0,s.jsx)(r.h2,{id:"arquivo-providertf",children:"Arquivo: provider.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-terraform",children:'provider "azurerm" {\n  features {}\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"arquivo-variablestf",children:"Arquivo: variables.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-terraform",children:'variable "location" {\n  description = "Localiza\xe7\xe3o dos recursos"\n  default     = "eastus"\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"arquivo-maintf",children:"Arquivo: main.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-terraform",children:'resource "azurerm_resource_group" "rg" {\n  name     = "rg-${terraform.workspace}"\n  location = var.location\n}\n\nresource "azurerm_storage_account" "storage" {\n  name                     = "st${terraform.workspace}acc${substr(md5(terraform.workspace), 0, 4)}"\n  resource_group_name      = azurerm_resource_group.rg.name\n  location                 = azurerm_resource_group.rg.location\n  account_tier             = "Standard"\n  account_replication_type = "LRS"\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"arquivo-outputstf",children:"Arquivo: outputs.tf"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-terraform",children:'output "storage_account_name" {\n  value = azurerm_storage_account.storage.name\n}\n\noutput "resource_group_name" {\n  value = azurerm_resource_group.rg.name\n}\n\noutput "workspace" {\n  value = terraform.workspace\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"comandos-terraform",children:"Comandos Terraform"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform init\n\nterraform workspace new dev\nterraform workspace select dev\nterraform apply\n\nterraform workspace new hml\nterraform workspace select hml\nterraform apply\n\nterraform workspace new prod\nterraform workspace select prod\nterraform apply\n"})}),"\n",(0,s.jsx)(r.h2,{id:"resultado-esperado",children:"Resultado Esperado"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Um resource group e uma storage account criados por ambiente"}),"\n",(0,s.jsx)(r.li,{children:"Recursos separados com base no nome do workspace ativo"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Exemplo de nomes:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Resource Group: ",(0,s.jsx)(r.code,{children:"rg-dev"}),", ",(0,s.jsx)(r.code,{children:"rg-hml"}),", ",(0,s.jsx)(r.code,{children:"rg-prod"})]}),"\n",(0,s.jsxs)(r.li,{children:["Storage Account: ",(0,s.jsx)(r.code,{children:"stdevaccxxxx"}),", ",(0,s.jsx)(r.code,{children:"sthmlaccxxxx"}),", ",(0,s.jsx)(r.code,{children:"stprodaccxxxx"})]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"dicas-e-boas-pr\xe1ticas",children:"Dicas e Boas Pr\xe1ticas"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Use ",(0,s.jsx)(r.code,{children:"terraform.workspace"})," para personalizar recursos por ambiente"]}),"\n",(0,s.jsxs)(r.li,{children:["Sempre verifique o workspace ativo com ",(0,s.jsx)(r.code,{children:"terraform workspace show"})]}),"\n",(0,s.jsx)(r.li,{children:"Evite usar workspaces para isolar projetos diferentes \u2014 ideal apenas para ambientes"}),"\n",(0,s.jsx)(r.li,{children:"Mantenha a estrutura de arquivos simples e reutiliz\xe1vel"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"destruindo-os-ambientes",children:"Destruindo os Ambientes"}),"\n",(0,s.jsxs)(r.p,{children:["Para remover os recursos criados, basta selecionar o workspace correspondente e executar o comando ",(0,s.jsx)(r.code,{children:"destroy"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform workspace select dev\nterraform destroy -auto-approve\n\nterraform workspace select hml\nterraform destroy -auto-approve\n\nterraform workspace select prod\nterraform destroy -auto-approve\n"})}),"\n",(0,s.jsx)(r.h2,{id:"dicas-e-boas-pr\xe1ticas-1",children:"Dicas e Boas Pr\xe1ticas"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Use ",(0,s.jsx)(r.code,{children:"terraform.workspace"})," para personalizar recursos por ambiente"]}),"\n",(0,s.jsxs)(r.li,{children:["Sempre verifique o workspace ativo com ",(0,s.jsx)(r.code,{children:"terraform workspace show"})]}),"\n",(0,s.jsx)(r.li,{children:"Evite usar workspaces para isolar projetos diferentes \u2014 ideal apenas para ambientes"}),"\n",(0,s.jsx)(r.li,{children:"Mantenha a estrutura de arquivos simples e reutiliz\xe1vel"}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.p,{children:"Este lab mostra como usar Terraform Workspaces para gerenciar m\xfaltiplos ambientes com o mesmo c\xf3digo, mantendo estados isolados e a infraestrutura organizada."})]})}function u(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,r,a)=>{a.d(r,{R:()=>i,x:()=>t});var o=a(6540);const s={},n=o.createContext(s);function i(e){const r=o.useContext(n);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(n.Provider,{value:r},e.children)}}}]);