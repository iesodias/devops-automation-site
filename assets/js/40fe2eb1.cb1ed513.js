"use strict";(self.webpackChunkdevops_automation_site=self.webpackChunkdevops_automation_site||[]).push([[6792],{8176:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>i,contentTitle:()=>t,default:()=>u,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"data-block","title":"Aula 8 - Bloco `data` no Terraform","description":"Introdu\xe7\xe3o","source":"@site/curso-terraform-udemy/14-data-block.md","sourceDirName":".","slug":"/data-block","permalink":"/udemy/terraform-automacao/data-block","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"id":"data-block","title":"Aula 8 - Bloco `data` no Terraform","noindex":true},"sidebar":"tutorialSidebar","previous":{"title":"Aula 7 - O Perigo do terraform.tfstate e a Solu\xe7\xe3o do Backend Remoto","permalink":"/udemy/terraform-automacao/backend-remote"},"next":{"title":"Lab 1 - Criando um Resource Group no Azure com Terraform","permalink":"/udemy/terraform-automacao/lab-1-rg"}}');var n=a(4848),s=a(8453);const d={id:"data-block",title:"Aula 8 - Bloco `data` no Terraform",noindex:!0},t="Bloco data no Terraform",i={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"O que \xe9 o bloco <code>data</code>",id:"o-que-\xe9-o-bloco-data",level:2},{value:"Explica\xe7\xe3o t\xe9cnica",id:"explica\xe7\xe3o-t\xe9cnica",level:2},{value:"Comando(s) usados",id:"comandos-usados",level:2},{value:"Exemplo pr\xe1tico",id:"exemplo-pr\xe1tico",level:2},{value:"Output esperado",id:"output-esperado",level:2},{value:"Melhores pr\xe1ticas",id:"melhores-pr\xe1ticas",level:2}];function l(e){const o={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsxs)(o.h1,{id:"bloco-data-no-terraform",children:["Bloco ",(0,n.jsx)(o.code,{children:"data"})," no Terraform"]})}),"\n",(0,n.jsx)(o.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(o.p,{children:["No Terraform, al\xe9m de criar recursos, tamb\xe9m \xe9 comum precisarmos ",(0,n.jsx)(o.strong,{children:"consultar dados existentes"})," em provedores de nuvem. Para isso, usamos o bloco ",(0,n.jsx)(o.code,{children:"data"}),". Ele permite acessar informa\xe7\xf5es que j\xe1 est\xe3o criadas, como VPCs, AMIs, zonas de disponibilidade, entre outros."]}),"\n",(0,n.jsx)(o.p,{children:"Este recurso \xe9 muito \xfaltil quando voc\xea quer usar elementos que j\xe1 existem no ambiente, mas n\xe3o quer (ou n\xe3o pode) cri\xe1-los novamente."}),"\n",(0,n.jsxs)(o.h2,{id:"o-que-\xe9-o-bloco-data",children:["O que \xe9 o bloco ",(0,n.jsx)(o.code,{children:"data"})]}),"\n",(0,n.jsxs)(o.p,{children:["O bloco ",(0,n.jsx)(o.code,{children:"data"})," \xe9 um tipo especial de bloco no Terraform usado para ",(0,n.jsx)(o.strong,{children:"consultar dados externos"})," de um provedor. Diferente dos blocos ",(0,n.jsx)(o.code,{children:"resource"}),", que criam infraestrutura, os blocos ",(0,n.jsx)(o.code,{children:"data"})," apenas leem e importam dados para uso dentro do c\xf3digo."]}),"\n",(0,n.jsx)(o.h2,{id:"explica\xe7\xe3o-t\xe9cnica",children:"Explica\xe7\xe3o t\xe9cnica"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["Um ",(0,n.jsx)(o.code,{children:"data"})," precisa de dois argumentos principais: ",(0,n.jsx)(o.strong,{children:"tipo"})," e ",(0,n.jsx)(o.strong,{children:"nome do recurso"}),"."]}),"\n",(0,n.jsxs)(o.li,{children:["O conte\xfado do ",(0,n.jsx)(o.code,{children:"data"})," define os filtros e par\xe2metros para buscar o recurso."]}),"\n",(0,n.jsxs)(o.li,{children:["Depois que o dado \xe9 lido, voc\xea pode us\xe1-lo com ",(0,n.jsx)(o.code,{children:"data.<tipo>.<nome>.atributo"})]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Exemplo de sintaxe:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-hcl",children:'data "aws_ami" "ubuntu" {\n  most_recent = true\n  owners      = ["099720109477"]\n  filter {\n    name   = "name"\n    values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]\n  }\n}\n'})}),"\n",(0,n.jsx)(o.h2,{id:"comandos-usados",children:"Comando(s) usados"}),"\n",(0,n.jsx)(o.p,{children:"Para aplicar e visualizar dados:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"terraform init\nterraform plan\nterraform apply\n"})}),"\n",(0,n.jsx)(o.h2,{id:"exemplo-pr\xe1tico",children:"Exemplo pr\xe1tico"}),"\n",(0,n.jsxs)(o.p,{children:["Vamos usar um bloco ",(0,n.jsx)(o.code,{children:"data"})," para buscar a AMI mais recente do Ubuntu 22.04 LTS na AWS e us\xe1-la para criar uma inst\xe2ncia EC2:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-hcl",children:'provider "aws" {\n  region = "us-east-1"\n}\n\ndata "aws_ami" "ubuntu" {\n  most_recent = true\n  owners      = ["099720109477"]\n  filter {\n    name   = "name"\n    values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]\n  }\n}\n\nresource "aws_instance" "web" {\n  ami           = data.aws_ami.ubuntu.id\n  instance_type = "t2.micro"\n  tags = {\n    Name = "ExemploComAMI"\n  }\n}\n'})}),"\n",(0,n.jsx)(o.h2,{id:"output-esperado",children:"Output esperado"}),"\n",(0,n.jsxs)(o.p,{children:["Ao rodar ",(0,n.jsx)(o.code,{children:"terraform apply"}),", voc\xea deve ver algo como:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'Apply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nOutputs:\naws_instance.web:\n  id = "i-0abc12345def6789"\n  ami = "ami-0abcdef1234567890"\n  instance_type = "t2.micro"\n  tags = {\n    Name = "ExemploComAMI"\n  }\n'})}),"\n",(0,n.jsx)(o.h2,{id:"melhores-pr\xe1ticas",children:"Melhores pr\xe1ticas"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["Sempre verifique os filtros usados nos blocos ",(0,n.jsx)(o.code,{children:"data"})," para evitar retornar dados errados."]}),"\n",(0,n.jsxs)(o.li,{children:["Use ",(0,n.jsx)(o.code,{children:"most_recent = true"})," apenas quando voc\xea quer garantir a imagem mais atual."]}),"\n",(0,n.jsx)(o.li,{children:"Evite depender de dados que mudam com frequ\xeancia sem controle (como AMIs p\xfablicas), pois isso pode afetar a consist\xeancia do ambiente."}),"\n",(0,n.jsxs)(o.li,{children:["Comente os blocos ",(0,n.jsx)(o.code,{children:"data"})," explicando por que aquele dado est\xe1 sendo buscado."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["O uso correto do bloco ",(0,n.jsx)(o.code,{children:"data"})," traz flexibilidade e reaproveitamento de recursos existentes, deixando seu c\xf3digo mais inteligente e integrado com a infraestrutura real."]})]})}function u(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,o,a)=>{a.d(o,{R:()=>d,x:()=>t});var r=a(6540);const n={},s=r.createContext(n);function d(e){const o=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),r.createElement(s.Provider,{value:o},e.children)}}}]);