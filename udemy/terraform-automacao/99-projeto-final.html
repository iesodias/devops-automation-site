<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-terraform-automacao docs-version-current docs-doc-page docs-doc-id-99-projeto-final" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Lab Final - Projeto Final Terraform - Azure VM Infrastructure | Aprenda DevOps do zero com tutoriais prático</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://devopsautomation.com.br/img/devops-logo-social.png"><meta data-rh="true" name="twitter:image" content="https://devopsautomation.com.br/img/devops-logo-social.png"><meta data-rh="true" property="og:url" content="https://devopsautomation.com.br/udemy/terraform-automacao/99-projeto-final"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-terraform-automacao-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-terraform-automacao-current"><meta data-rh="true" property="og:title" content="Lab Final - Projeto Final Terraform - Azure VM Infrastructure | Aprenda DevOps do zero com tutoriais prático"><meta data-rh="true" name="description" content="Introdução"><meta data-rh="true" property="og:description" content="Introdução"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://devopsautomation.com.br/udemy/terraform-automacao/99-projeto-final"><link data-rh="true" rel="alternate" href="https://devopsautomation.com.br/udemy/terraform-automacao/99-projeto-final" hreflang="en"><link data-rh="true" rel="alternate" href="https://devopsautomation.com.br/udemy/terraform-automacao/99-projeto-final" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Aprenda DevOps do zero com tutoriais prático RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Aprenda DevOps do zero com tutoriais prático Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BRH4789ZE0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BRH4789ZE0",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.0b240cd6.css">
<script src="/assets/js/runtime~main.e95a4e1d.js" defer="defer"></script>
<script src="/assets/js/main.4c95f2fe.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo-home.png"><link rel="preload" as="image" href="/img/devops-logo.png"><link rel="preload" as="image" href="/img/logos_youtube-icon.avif"><link rel="preload" as="image" href="/img/devicon_linkedin.avif"><link rel="preload" as="image" href="/img/skill-icons_instagram.avif"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-home.png" alt="Logo DevOps Automation" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-home.png" alt="Logo DevOps Automation" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Tutoriais</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/#cursos">Cursos</a><a href="https://youtube.com/@iesodias" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/#instrutor">Instrutor</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao">Introdução</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/iac">Modulo 0 - Conceitos Iniciais</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/hcl-intro">Modulo 1 - Introdução ao Terraform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-1-rg">Labs 1 - Introdução ao Terraform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/trivy-teorico">Modulo 2 - Análise Estática (SAST) para IaC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-10-trivy">Labs 2 - Análise Estática (SAST) para IaC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/12-opa-teoria">Modulo 3 - Policy as Code (PaC)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-15-confest-opa">Labs 3 - Policy as Code (PaC)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/17-modulos-teoria">Modulo 4 - Módulos no Terraform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-18-modulos">Labs 4 - Módulos</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/19-dados-sensiveis">Modulo 5 - Protegendo Dados Sensiveis com Vault</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/23-terraform-cloud">Modulo 5 - Terraform Cloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/25-lab-sentinel-tfc">Lab 5 - Terraform Cloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/udemy/terraform-automacao/98-projeto-final">Projeto Final</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/udemy/terraform-automacao/98-projeto-final">Aula Final - Projeto Final Terraform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/udemy/terraform-automacao/99-projeto-final">Lab Final - Projeto Final Terraform - Azure VM Infrastructure</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/bonus-certificacao">Certificação HashiCorp</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Projeto Final</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab Final - Projeto Final Terraform - Azure VM Infrastructure</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Projeto Final Terraform - Azure VM Infrastructure</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introdução">Introdução<a href="#introdução" class="hash-link" aria-label="Direct link to Introdução" title="Direct link to Introdução">​</a></h2>
<p>Este projeto demonstra o uso avançado do Terraform para criar uma infraestrutura completa no Azure, incluindo VMs Linux, networking, storage, security, monitoring e backup. O projeto abrange as principais funcionalidades do Terraform como variables, locals, outputs, count, providers múltiplos e recursos condicionais.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="arquitetura">Arquitetura<a href="#arquitetura" class="hash-link" aria-label="Direct link to Arquitetura" title="Direct link to Arquitetura">​</a></h2>
<ul>
<li><strong>Compute</strong>: VMs Linux Ubuntu com discos adicionais</li>
<li><strong>Networking</strong>: VNet, Subnets, NSGs, Public IPs</li>
<li><strong>Security</strong>: Key Vault, SSH Keys, Application Security Groups</li>
<li><strong>Storage</strong>: Storage Account, Managed Disks</li>
<li><strong>Monitoring</strong>: Log Analytics, Azure Monitor, Alerts</li>
<li><strong>Backup</strong>: Recovery Services Vault (condicional)</li>
<li><strong>Automation</strong>: Auto-shutdown para economia de custos</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pré-requisitos">Pré-requisitos<a href="#pré-requisitos" class="hash-link" aria-label="Direct link to Pré-requisitos" title="Direct link to Pré-requisitos">​</a></h2>
<ul>
<li>Azure CLI instalado e configurado</li>
<li>Terraform &gt;= 1.5.0</li>
<li>Conta Azure (free tier funciona)</li>
<li>Git (opcional)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="passo-a-passo">Passo a Passo<a href="#passo-a-passo" class="hash-link" aria-label="Direct link to Passo a Passo" title="Direct link to Passo a Passo">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-criação-da-estrutura-do-projeto">1. Criação da Estrutura do Projeto<a href="#1-criação-da-estrutura-do-projeto" class="hash-link" aria-label="Direct link to 1. Criação da Estrutura do Projeto" title="Direct link to 1. Criação da Estrutura do Projeto">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir azure-terraform-vm-project &amp;&amp; cd azure-terraform-vm-project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch {main,variables,locals,outputs,versions,additional-resources}.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch {terraform,dev,prod}.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch README.md .gitignore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-configuração-do-gitignore">2. Configuração do .gitignore<a href="#2-configuração-do-gitignore" class="hash-link" aria-label="Direct link to 2. Configuração do .gitignore" title="Direct link to 2. Configuração do .gitignore">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; .gitignore &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*.tfstate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*.tfstate.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.terraform/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.terraform.lock.hcl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crash.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">override.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*.swp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-criação-dos-arquivos-terraform">3. Criação dos Arquivos Terraform<a href="#3-criação-dos-arquivos-terraform" class="hash-link" aria-label="Direct link to 3. Criação dos Arquivos Terraform" title="Direct link to 3. Criação dos Arquivos Terraform">​</a></h3>
<p><strong>main.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;azurerm&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  features {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_group {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prevent_deletion_if_contains_resources = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_machine {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      delete_os_disk_on_deletion     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      graceful_shutdown              = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      skip_shutdown_and_force_delete = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data sources para informações existentes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data &quot;azurerm_client_config&quot; &quot;current&quot; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Resource Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_resource_group&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name     = local.resource_group_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location = var.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Virtual Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_virtual_network&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = local.vnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address_space       = [var.vnet_address_space]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_subnet&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 = local.web_subnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name  = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_network_name = azurerm_virtual_network.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address_prefixes     = [var.web_subnet_address_prefix]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_subnet&quot; &quot;database&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 = local.db_subnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name  = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_network_name = azurerm_virtual_network.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  address_prefixes     = [var.db_subnet_address_prefix]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Network Security Groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_network_security_group&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = local.web_nsg_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # HTTP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security_rule {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                       = &quot;HTTP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority                   = 1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_port_range     = &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_address_prefix      = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security_rule {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                       = &quot;HTTPS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority                   = 1002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_port_range     = &quot;443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_address_prefix      = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # SSH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security_rule {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                       = &quot;SSH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority                   = 1003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_port_range     = &quot;22&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_address_prefix      = var.ssh_source_address_prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Associate NSG to subnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_subnet_network_security_group_association&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id                 = azurerm_subnet.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_security_group_id = azurerm_network_security_group.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Public IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_public_ip&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.public_ip_name}-${count.index + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allocation_method   = &quot;Dynamic&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  domain_name_label   = &quot;${local.dns_prefix}-${count.index + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Load Balancer (quando há mais de uma VM)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_lb&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.vm_count &gt; 1 ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = local.lb_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frontend_ip_configuration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                 = &quot;PublicIPAddress&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public_ip_address_id = azurerm_public_ip.lb[0].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_public_ip&quot; &quot;lb&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.vm_count &gt; 1 ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.public_ip_name}-lb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allocation_method   = &quot;Static&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku                = &quot;Standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Network Interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_network_interface&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.nic_name}-${count.index + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ip_configuration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name                          = &quot;internal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subnet_id                     = azurerm_subnet.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private_ip_address_allocation = &quot;Dynamic&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public_ip_address_id          = var.vm_count == 1 ? azurerm_public_ip.main[count.index].id : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Generate SSH key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;tls_private_key&quot; &quot;ssh&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  algorithm = &quot;RSA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rsa_bits  = 4096</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Storage Account para boot diagnostics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;random_id&quot; &quot;storage_suffix&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  byte_length = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_storage_account&quot; &quot;boot_diagnostics&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                     = &quot;${local.storage_account_prefix}${random_id.storage_suffix.hex}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name      = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location                 = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  account_tier             = &quot;Standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  account_replication_type = &quot;LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Key Vault para armazenar secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_key_vault&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                       = local.key_vault_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location                   = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name        = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tenant_id                  = data.azurerm_client_config.current.tenant_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku_name                   = &quot;standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  soft_delete_retention_days = 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  access_policy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tenant_id = data.azurerm_client_config.current.tenant_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    object_id = data.azurerm_client_config.current.object_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret_permissions = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Get&quot;, &quot;List&quot;, &quot;Set&quot;, &quot;Delete&quot;, &quot;Purge&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Armazenar chave SSH no Key Vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_key_vault_secret&quot; &quot;ssh_private_key&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name         = &quot;ssh-private-key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value        = tls_private_key.ssh.private_key_pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key_vault_id = azurerm_key_vault.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Virtual Machines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_linux_virtual_machine&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count                           = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                            = &quot;${local.vm_name}-${count.index + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location                        = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name             = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  size                            = var.vm_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  admin_username                  = var.admin_username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disable_password_authentication = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_interface_ids = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    azurerm_network_interface.main[count.index].id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  admin_ssh_key {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username   = var.admin_username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public_key = tls_private_key.ssh.public_key_openssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os_disk {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    caching              = &quot;ReadWrite&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_account_type = var.os_disk_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source_image_reference {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publisher = var.vm_image.publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    offer     = var.vm_image.offer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sku       = var.vm_image.sku</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version   = var.vm_image.version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  boot_diagnostics {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_account_uri = azurerm_storage_account.boot_diagnostics.primary_blob_endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls_private_key.ssh,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    azurerm_key_vault_secret.ssh_private_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = merge(local.common_tags, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name = &quot;${local.vm_name}-${count.index + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tier = &quot;Web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Managed Disk adicional para dados</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_managed_disk&quot; &quot;data&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count                = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 = &quot;${local.vm_name}-${count.index + 1}-data-disk&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location             = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name  = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage_account_type = &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  create_option        = &quot;Empty&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disk_size_gb         = var.data_disk_size_gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Anexar disco de dados às VMs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_virtual_machine_data_disk_attachment&quot; &quot;data&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count              = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  managed_disk_id    = azurerm_managed_disk.data[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_machine_id = azurerm_linux_virtual_machine.main[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lun                = &quot;10&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caching            = &quot;ReadWrite&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>variables.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;project_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome do projeto que será usado como prefixo para recursos&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;webapp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(regex(&quot;^[a-z0-9]+$&quot;, var.project_name))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Project name deve conter apenas letras minúsculas e números.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;environment&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Environment (dev, staging, prod)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = contains([&quot;dev&quot;, &quot;staging&quot;, &quot;prod&quot;], var.environment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Environment deve ser: dev, staging, ou prod.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;location&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Azure region onde os recursos serão criados&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;Brazil South&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = contains([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Brazil South&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;East US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;East US 2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;West US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;West US 2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Central US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;North Central US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;South Central US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;West Central US&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Canada Central&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Canada East&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;West Europe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;North Europe&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;UK South&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;UK West&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;France Central&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Germany West Central&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Switzerland North&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Norway East&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Sweden Central&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ], var.location)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Location deve ser uma região Azure válida.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;vm_count&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Número de VMs a serem criadas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = var.vm_count &gt;= 1 &amp;&amp; var.vm_count &lt;= 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;VM count deve estar entre 1 e 5.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;vm_size&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Tamanho da VM&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;Standard_B2s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = contains([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_B1s&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_B1ms&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_B2s&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_B2ms&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_B4ms&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_D2s_v3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_D4s_v3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_F2s_v2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_F4s_v2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ], var.vm_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;VM size deve ser um dos tamanhos aprovados.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;admin_username&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome de usuário administrativo para as VMs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;azureuser&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(regex(&quot;^[a-z][a-z0-9]{2,19}$&quot;, var.admin_username))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Admin username deve começar com letra minúscula e ter entre 3-20 caracteres.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;os_disk_type&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Tipo do disco do OS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = contains([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Standard_LRS&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;StandardSSD_LRS&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ], var.os_disk_type)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;OS disk type deve ser: Standard_LRS, StandardSSD_LRS, ou Premium_LRS.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;data_disk_size_gb&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Tamanho do disco de dados em GB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = 64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = var.data_disk_size_gb &gt;= 32 &amp;&amp; var.data_disk_size_gb &lt;= 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Data disk size deve estar entre 32GB e 1024GB.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;vnet_address_space&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Address space para a VNet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.0.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(cidrhost(var.vnet_address_space, 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;VNet address space deve ser um CIDR válido.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;web_subnet_address_prefix&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Address prefix para a subnet web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.0.1.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(cidrhost(var.web_subnet_address_prefix, 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Web subnet address prefix deve ser um CIDR válido.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;db_subnet_address_prefix&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Address prefix para a subnet de banco de dados&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.0.2.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(cidrhost(var.db_subnet_address_prefix, 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;DB subnet address prefix deve ser um CIDR válido.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;ssh_source_address_prefix&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Source address prefix permitido para SSH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = can(cidrhost(var.ssh_source_address_prefix, 0)) || var.ssh_source_address_prefix == &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;SSH source address prefix deve ser um CIDR válido ou &#x27;*&#x27;.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;vm_image&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Imagem da VM&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publisher = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    offer     = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sku       = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publisher = &quot;Canonical&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    offer     = &quot;0001-com-ubuntu-server-focal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sku       = &quot;20_04-lts-gen2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version   = &quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;tags&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Tags adicionais para aplicar aos recursos&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = map(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = alltrue([for k, v in var.tags : can(regex(&quot;^[a-zA-Z0-9_.-]+$&quot;, k))])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Tag keys devem conter apenas letras, números, hífens, underscores e pontos.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_backup&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Habilitar backup das VMs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;backup_retention_days&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Número de dias para retenção de backup&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = var.backup_retention_days &gt;= 7 &amp;&amp; var.backup_retention_days &lt;= 365</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Backup retention deve estar entre 7 e 365 dias.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_monitoring&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Habilitar monitoring com Log Analytics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;auto_shutdown_time&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Horário para auto shutdown das VMs (formato 24h: HHMM)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;1800&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition     = can(regex(&quot;^([01]?[0-9]|2[0-3])[0-5][0-9]$&quot;, var.auto_shutdown_time))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Auto shutdown time deve estar no formato HHMM (ex: 1800 para 18:00).&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;auto_shutdown_timezone&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Timezone para auto shutdown&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;E. South America Standard Time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;notification_email&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Email para receber notificações de auto-shutdown (opcional)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = var.notification_email == &quot;&quot; || can(regex(&quot;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$&quot;, var.notification_email))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Notification email deve ser um email válido ou string vazia.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;allowed_ssh_cidrs&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Lista de CIDRs permitidos para acesso SSH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = list(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  validation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    condition = alltrue([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for cidr in var.allowed_ssh_cidrs : can(cidrhost(cidr, 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_message = &quot;Todos os CIDRs devem ser válidos.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>locals.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Naming conventions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  naming_prefix = &quot;${var.project_name}-${var.environment}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Resource names usando naming convention</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name    = &quot;${local.naming_prefix}-rg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vnet_name             = &quot;${local.naming_prefix}-vnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  web_subnet_name       = &quot;${local.naming_prefix}-subnet-web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  db_subnet_name        = &quot;${local.naming_prefix}-subnet-db&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  web_nsg_name          = &quot;${local.naming_prefix}-nsg-web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  db_nsg_name           = &quot;${local.naming_prefix}-nsg-db&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public_ip_name        = &quot;${local.naming_prefix}-pip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nic_name              = &quot;${local.naming_prefix}-nic&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vm_name               = &quot;${local.naming_prefix}-vm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lb_name               = &quot;${local.naming_prefix}-lb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  key_vault_name        = &quot;${local.naming_prefix}-kv-${random_id.storage_suffix.hex}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_analytics_name    = &quot;${local.naming_prefix}-law&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storage_account_prefix = replace(&quot;${var.project_name}${var.environment}diag&quot;, &quot;-&quot;, &quot;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # DNS prefix para Public IPs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dns_prefix = &quot;${var.project_name}${var.environment}${random_id.storage_suffix.hex}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Common tags aplicadas a todos os recursos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  common_tags = merge({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Project     = var.project_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment = var.environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ManagedBy   = &quot;Terraform&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CreatedBy   = &quot;TerraformProject&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CreatedOn   = formatdate(&quot;YYYY-MM-DD&quot;, timestamp())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Owner       = &quot;DevOps Team&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CostCenter  = &quot;IT-Infrastructure&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Backup      = var.enable_backup ? &quot;Enabled&quot; : &quot;Disabled&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Monitoring  = var.enable_monitoring ? &quot;Enabled&quot; : &quot;Disabled&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }, var.tags)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Network configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vnet_address_space         = var.vnet_address_space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    web_subnet_address_prefix  = var.web_subnet_address_prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db_subnet_address_prefix   = var.db_subnet_address_prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dns_servers               = [&quot;168.63.129.16&quot;] # Azure DNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # VM configuration baseada no environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vm_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dev = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      size                = &quot;Standard_B1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      os_disk_type       = &quot;Standard_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data_disk_size_gb  = 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_backup      = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto_shutdown      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    staging = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      size                = &quot;Standard_B2s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      os_disk_type       = &quot;StandardSSD_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data_disk_size_gb  = 64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_backup      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto_shutdown      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prod = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      size                = &quot;Standard_D2s_v3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      os_disk_type       = &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data_disk_size_gb  = 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_backup      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto_shutdown      = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # VM size baseado no environment (override da variável se não especificado)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  effective_vm_size = var.vm_size != &quot;Standard_B2s&quot; ? var.vm_size : local.vm_config[var.environment].size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  effective_os_disk_type = var.os_disk_type != &quot;Premium_LRS&quot; ? var.os_disk_type : local.vm_config[var.environment].os_disk_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  effective_data_disk_size = var.data_disk_size_gb != 64 ? var.data_disk_size_gb : local.vm_config[var.environment].data_disk_size_gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Security rules dinâmicas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  web_security_rules = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name                       = &quot;HTTP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      priority                   = 1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_port_range     = &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_address_prefix      = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name                       = &quot;HTTPS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      priority                   = 1002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_port_range     = &quot;443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_address_prefix      = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # SSH rules para cada CIDR permitido</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssh_security_rules = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i, cidr in var.allowed_ssh_cidrs : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name                       = &quot;SSH-${i + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      priority                   = 1100 + i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      direction                  = &quot;Inbound&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      access                     = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol                   = &quot;Tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_port_range          = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_port_range     = &quot;22&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_address_prefix      = cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Todas as security rules combinadas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  all_security_rules = concat(local.web_security_rules, local.ssh_security_rules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Configuração de backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backup_config = var.enable_backup ? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    policy_name           = &quot;${local.naming_prefix}-backup-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vault_name           = &quot;${local.naming_prefix}-rsv&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retention_daily      = var.backup_retention_days</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retention_weekly     = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retention_monthly    = 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retention_yearly     = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backup_time         = &quot;23:00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backup_timezone     = var.auto_shutdown_timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Monitoring configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring_config = var.enable_monitoring ? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workspace_name       = local.log_analytics_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retention_days      = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sku                 = &quot;PerGB2018&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    solutions = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;VMInsights&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Security&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Updates&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Auto-shutdown configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto_shutdown_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled          = local.vm_config[var.environment].auto_shutdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time            = var.auto_shutdown_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timezone        = var.auto_shutdown_timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    notification_settings = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled         = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      time_in_minutes = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      webhook_url     = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      email_recipient = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Conditional resources flags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  should_create_load_balancer = var.vm_count &gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  should_create_backup = var.enable_backup &amp;&amp; local.vm_config[var.environment].enable_backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  should_create_monitoring = var.enable_monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  should_enable_auto_shutdown = local.auto_shutdown_config.enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Location mapping para short names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location_short = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Brazil South&quot;              = &quot;brs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;East US&quot;                   = &quot;eus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;East US 2&quot;                 = &quot;eus2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;West US&quot;                   = &quot;wus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;West US 2&quot;                 = &quot;wus2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Central US&quot;                = &quot;cus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;North Central US&quot;          = &quot;ncus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;South Central US&quot;          = &quot;scus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;West Central US&quot;           = &quot;wcus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Canada Central&quot;            = &quot;cac&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Canada East&quot;               = &quot;cae&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;West Europe&quot;               = &quot;weu&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;North Europe&quot;              = &quot;neu&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;UK South&quot;                  = &quot;uks&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;UK West&quot;                   = &quot;ukw&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;France Central&quot;            = &quot;frc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Germany West Central&quot;      = &quot;gwc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Switzerland North&quot;         = &quot;swn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Norway East&quot;               = &quot;noe&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Sweden Central&quot;            = &quot;sec&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Resource naming com location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location_suffix = lookup(local.location_short, var.location, &quot;unknown&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Advanced naming com location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  advanced_naming = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_group    = &quot;${local.naming_prefix}-${local.location_suffix}-rg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_account   = lower(replace(&quot;${var.project_name}${var.environment}${local.location_suffix}sa${random_id.storage_suffix.hex}&quot;, &quot;-&quot;, &quot;&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key_vault        = &quot;${local.naming_prefix}-${local.location_suffix}-kv&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Network ACLs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_acls = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_action = &quot;Deny&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_rules = var.environment == &quot;prod&quot; ? [] : [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_network_subnet_ids = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Será preenchido após criação das subnets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>outputs.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Resource Group information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;resource_group_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome do Resource Group criado&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;resource_group_location&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Localização do Resource Group&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;resource_group_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;ID do Resource Group&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_resource_group.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Network information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;virtual_network_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome da Virtual Network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_virtual_network.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;virtual_network_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;ID da Virtual Network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_virtual_network.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;virtual_network_address_space&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Address space da Virtual Network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_virtual_network.main.address_space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;web_subnet_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;ID da subnet web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_subnet.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;database_subnet_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;ID da subnet database&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_subnet.database.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VM information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vm_names&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nomes das VMs criadas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_linux_virtual_machine.main[*].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vm_ids&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;IDs das VMs criadas&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_linux_virtual_machine.main[*].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vm_private_ip_addresses&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Endereços IP privados das VMs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for nic in azurerm_network_interface.main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nic.ip_configuration[0].private_ip_address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vm_public_ip_addresses&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Endereços IP públicos das VMs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for pip in azurerm_public_ip.main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pip.ip_address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;vm_fqdns&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;FQDNs das VMs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for pip in azurerm_public_ip.main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pip.fqdn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Load Balancer information (quando aplicável)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;load_balancer_public_ip&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;IP público do Load Balancer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = var.vm_count &gt; 1 ? azurerm_public_ip.lb[0].ip_address : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;load_balancer_fqdn&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;FQDN do Load Balancer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = var.vm_count &gt; 1 ? azurerm_public_ip.lb[0].fqdn : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SSH Key information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;ssh_private_key_pem&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Chave SSH privada em formato PEM&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = tls_private_key.ssh.private_key_pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensitive   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;ssh_public_key&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Chave SSH pública&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = tls_private_key.ssh.public_key_openssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Storage Account information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;boot_diagnostics_storage_account_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome da Storage Account para boot diagnostics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_storage_account.boot_diagnostics.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;boot_diagnostics_storage_account_primary_endpoint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Endpoint primário da Storage Account&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_storage_account.boot_diagnostics.primary_blob_endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Key Vault information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;key_vault_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nome do Key Vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_key_vault.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;key_vault_uri&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;URI do Key Vault&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_key_vault.main.vault_uri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Data disk information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;data_disk_names&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Nomes dos discos de dados&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_managed_disk.data[*].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;data_disk_sizes&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Tamanhos dos discos de dados em GB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_managed_disk.data[*].disk_size_gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Network Security Group information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;web_nsg_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;ID do Network Security Group web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = azurerm_network_security_group.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;web_nsg_security_rules&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Regras de segurança do NSG web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for rule in azurerm_network_security_group.web.security_rule :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name                   = rule.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      priority               = rule.priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      direction              = rule.direction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      access                 = rule.access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      protocol               = rule.protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination_port_range = rule.destination_port_range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Summary information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;deployment_summary&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Resumo do deployment&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    project_name          = var.project_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment           = var.environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location              = var.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vm_count              = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vm_size               = local.effective_vm_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_group        = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_network       = azurerm_virtual_network.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_balancer_enabled = var.vm_count &gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backup_enabled        = var.enable_backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    monitoring_enabled    = var.enable_monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total_data_disk_gb    = sum(azurerm_managed_disk.data[*].disk_size_gb)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_date         = formatdate(&quot;YYYY-MM-DD hh:mm:ss ZZZ&quot;, timestamp())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cost estimation helper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cost_estimation_info&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Informações para estimativa de custos&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    region = var.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vms = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for i in range(var.vm_count) : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name           = azurerm_linux_virtual_machine.main[i].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        size           = azurerm_linux_virtual_machine.main[i].size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os_disk_type   = azurerm_linux_virtual_machine.main[i].os_disk[0].storage_account_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_disk_type = azurerm_managed_disk.data[i].storage_account_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_disk_size = azurerm_managed_disk.data[i].disk_size_gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_accounts = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name         = azurerm_storage_account.boot_diagnostics.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        account_tier = azurerm_storage_account.boot_diagnostics.account_tier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        replication  = azurerm_storage_account.boot_diagnostics.account_replication_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public_ips    = length(azurerm_public_ip.main) + (var.vm_count &gt; 1 ? 1 : 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_balancer = var.vm_count &gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Connection information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;connection_info&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Informações de conexão SSH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username = var.admin_username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssh_command = var.vm_count == 1 ? [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;ssh -i private_key.pem ${var.admin_username}@${azurerm_public_ip.main[0].ip_address}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ] : [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for i, pip in azurerm_public_ip.main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;ssh -i private_key.pem ${var.admin_username}@${pip.ip_address} # VM ${i + 1}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DNS information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;dns_information&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Informações de DNS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public_dns_names = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for pip in azurerm_public_ip.main :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pip.fqdn if pip.fqdn != null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    load_balancer_dns = var.vm_count &gt; 1 ? azurerm_public_ip.lb[0].fqdn : null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>versions.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configurações de versão e provider requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_version = &quot;&gt;= 1.5.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_providers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    azurerm = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/azurerm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 3.85&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    random = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/random&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 3.6&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/tls&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 4.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 0.10&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/null&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 3.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Configuração do backend (descomente se usar remote state)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # backend &quot;azurerm&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   resource_group_name  = &quot;terraform-state-rg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   storage_account_name = &quot;terraformstatexxxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   container_name       = &quot;tfstate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #   key                  = &quot;webapp-dev.tfstate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>additional-resources.tf</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Recursos adicionais para demonstrar funcionalidades avançadas do Terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Log Analytics Workspace (condicional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_log_analytics_workspace&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_monitoring ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = local.log_analytics_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku                 = &quot;PerGB2018&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retention_in_days   = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VM Extension para Log Analytics Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_virtual_machine_extension&quot; &quot;log_analytics&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count                = var.enable_monitoring ? var.vm_count : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 = &quot;OmsAgentForLinux&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_machine_id   = azurerm_linux_virtual_machine.main[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publisher            = &quot;Microsoft.EnterpriseCloud.Monitoring&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type                 = &quot;OmsAgentForLinux&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type_handler_version = &quot;1.13&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  settings = jsonencode({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workspaceId = azurerm_log_analytics_workspace.main[0].workspace_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protected_settings = jsonencode({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workspaceKey = azurerm_log_analytics_workspace.main[0].primary_shared_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Recovery Services Vault (condicional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_recovery_services_vault&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_backup ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.naming_prefix}-rsv&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku                 = &quot;Standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  soft_delete_enabled = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Backup Policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_backup_policy_vm&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_backup ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.naming_prefix}-backup-policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recovery_vault_name = azurerm_recovery_services_vault.main[0].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backup {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frequency = &quot;Daily&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time      = &quot;23:00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retention_daily {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count = var.backup_retention_days</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retention_weekly {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count    = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weekdays = [&quot;Sunday&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  retention_monthly {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count    = 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weekdays = [&quot;Sunday&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weeks    = [&quot;First&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Protected VM (Backup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_backup_protected_vm&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_backup ? var.vm_count : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recovery_vault_name = azurerm_recovery_services_vault.main[0].name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source_vm_id        = azurerm_linux_virtual_machine.main[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backup_policy_id    = azurerm_backup_policy_vm.main[0].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Auto-shutdown schedule para VMs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_dev_test_global_vm_shutdown_schedule&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count              = local.should_enable_auto_shutdown ? var.vm_count : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_machine_id = azurerm_linux_virtual_machine.main[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location           = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled            = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  daily_recurrence_time = var.auto_shutdown_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  timezone              = var.auto_shutdown_timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # notification_settings é obrigatório - desabilitado se não houver email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  notification_settings {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled         = var.notification_email != &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time_in_minutes = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email           = var.notification_email != &quot;&quot; ? var.notification_email : &quot;noreply@example.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Application Security Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_application_security_group&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.naming_prefix}-asg-web&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location            = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Associate NICs with ASG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_network_interface_application_security_group_association&quot; &quot;web&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count                         = var.vm_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_interface_id          = azurerm_network_interface.main[count.index].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application_security_group_id = azurerm_application_security_group.web.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Azure Monitor Action Group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_monitor_action_group&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_monitoring ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${local.naming_prefix}-actiongroup&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_name          = &quot;webapp-ag&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email_receiver {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name          = &quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email_address = &quot;admin@empresa.com.br&quot; # Substitua por um email real</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Metric Alert para CPU alta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_monitor_metric_alert&quot; &quot;cpu_high&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count               = var.enable_monitoring ? var.vm_count : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${azurerm_linux_virtual_machine.main[count.index].name}-cpu-alert&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scopes              = [azurerm_linux_virtual_machine.main[count.index].id]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description         = &quot;Alert when CPU usage is over 80%&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  severity            = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  criteria {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metric_namespace = &quot;Microsoft.Compute/virtualMachines&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metric_name      = &quot;Percentage CPU&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aggregation      = &quot;Average&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    operator         = &quot;GreaterThan&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    threshold        = 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  action {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    action_group_id = azurerm_monitor_action_group.main[0].id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Availability Set para VMs (quando há múltiplas VMs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_availability_set&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count                        = var.vm_count &gt; 1 ? 1 : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                         = &quot;${local.naming_prefix}-avset&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location                     = azurerm_resource_group.main.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name          = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  platform_fault_domain_count  = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  platform_update_domain_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  managed                      = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Private DNS Zone para resolução interna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_private_dns_zone&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                = &quot;${var.project_name}.local&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Link da Private DNS Zone com a VNet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_private_dns_zone_virtual_network_link&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                  = &quot;${local.naming_prefix}-dns-link&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_group_name   = azurerm_resource_group.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_dns_zone_name = azurerm_private_dns_zone.main.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  virtual_network_id    = azurerm_virtual_network.main.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registration_enabled  = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags = local.common_tags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-configuração-dos-ambientes">4. Configuração dos Ambientes<a href="#4-configuração-dos-ambientes" class="hash-link" aria-label="Direct link to 4. Configuração dos Ambientes" title="Direct link to 4. Configuração dos Ambientes">​</a></h3>
<p><strong>terraform.tfvars</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configuração principal do projeto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Informações do projeto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_name = &quot;webapp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environment  = &quot;dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location     = &quot;Brazil South&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configuração das VMs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_count          = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_size           = &quot;Standard_B2s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin_username    = &quot;azureuser&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os_disk_type      = &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_disk_size_gb = 64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configuração de rede</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vnet_address_space        = &quot;10.0.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">web_subnet_address_prefix = &quot;10.0.1.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_subnet_address_prefix  = &quot;10.0.2.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh_source_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Lista de CIDRs permitidos para SSH (mais seguro que o source_address_prefix)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allowed_ssh_cidrs = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;0.0.0.0/0&quot; # Substitua pelo seu IP ou range corporativo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # &quot;201.123.45.0/24&quot;,  # Exemplo: range corporativo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # &quot;10.0.0.0/8&quot;        # Exemplo: rede interna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Imagem da VM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_image = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publisher = &quot;Canonical&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  offer     = &quot;0001-com-ubuntu-server-focal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku       = &quot;20_04-lts-gen2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version   = &quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configurações opcionais</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_backup         = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backup_retention_days = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_monitoring     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Auto-shutdown para economizar custos em dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_time     = &quot;1900&quot; # 19:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_timezone = &quot;E. South America Standard Time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Email para notificações (opcional - deixe vazio se não quiser notificações)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification_email = &quot;&quot; # Exemplo: &quot;seuemail@dominio.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tags personalizadas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Owner      = &quot;DevOps Team&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CostCenter = &quot;TI-Infraestrutura&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Project    = &quot;Projeto Final Terraform&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Course     = &quot;Udemy Terraform&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Student    = &quot;Seu Nome Aqui&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Purpose    = &quot;Learning&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Department = &quot;Engineering&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>dev.tfvars</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configuração específica para ambiente de desenvolvimento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_name = &quot;webapp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environment  = &quot;dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location     = &quot;Brazil South&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VMs menores para dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_count          = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_size           = &quot;Standard_B1s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin_username    = &quot;azureuser&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os_disk_type      = &quot;Standard_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_disk_size_gb = 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Rede simplificada</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vnet_address_space        = &quot;10.10.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">web_subnet_address_prefix = &quot;10.10.1.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_subnet_address_prefix  = &quot;10.10.2.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Segurança relaxada para dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh_source_address_prefix = &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allowed_ssh_cidrs         = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Imagem Ubuntu LTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_image = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publisher = &quot;Canonical&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  offer     = &quot;0001-com-ubuntu-server-focal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku       = &quot;20_04-lts-gen2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version   = &quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Features desabilitadas para economizar custos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_backup     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_monitoring = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Auto-shutdown habilitado</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_time     = &quot;1800&quot; # 18:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_timezone = &quot;E. South America Standard Time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Email para notificações (opcional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification_email = &quot;&quot; # Deixe vazio para sem notificações</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tags de desenvolvimento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Owner       = &quot;Developer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CostCenter  = &quot;R&amp;D&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Environment = &quot;Development&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AutoDelete  = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Purpose     = &quot;Learning&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Course      = &quot;Terraform Udemy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>prod.tfvars</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configuração específica para ambiente de produção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_name = &quot;webapp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environment  = &quot;prod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location     = &quot;Brazil South&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VMs robustas para produção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_count          = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_size           = &quot;Standard_D2s_v3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin_username    = &quot;prodadmin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os_disk_type      = &quot;Premium_LRS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data_disk_size_gb = 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Rede segmentada</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vnet_address_space        = &quot;10.0.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">web_subnet_address_prefix = &quot;10.0.1.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_subnet_address_prefix  = &quot;10.0.2.0/24&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Segurança restrita - substitua pelos IPs da sua organização</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh_source_address_prefix = &quot;203.0.113.0/24&quot; # Substitua pelo range corporativo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allowed_ssh_cidrs = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;203.0.113.0/24&quot;, # Range corporativo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;198.51.100.0/24&quot; # VPN range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Imagem Ubuntu LTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vm_image = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  publisher = &quot;Canonical&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  offer     = &quot;0001-com-ubuntu-server-focal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sku       = &quot;20_04-lts-gen2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  version   = &quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Features completas para produção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_backup         = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backup_retention_days = 90</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_monitoring     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sem auto-shutdown em produção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_time     = &quot;0000&quot; # Desabilitado</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto_shutdown_timezone = &quot;E. South America Standard Time&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tags de produção</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tags = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Owner        = &quot;Operations Team&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CostCenter   = &quot;Production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Environment  = &quot;Production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Criticality  = &quot;High&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BackupPolicy = &quot;Daily&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Monitoring   = &quot;24x7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Compliance   = &quot;Required&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataClass    = &quot;Confidential&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-configuração-do-azure">5. Configuração do Azure<a href="#5-configuração-do-azure" class="hash-link" aria-label="Direct link to 5. Configuração do Azure" title="Direct link to 5. Configuração do Azure">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az account list --output table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az account set --subscription &quot;sua-subscription-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az account show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ARM_SUBSCRIPTION_ID=&quot;sua-subscription-id&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-inicialização-e-deploy">6. Inicialização e Deploy<a href="#6-inicialização-e-deploy" class="hash-link" aria-label="Direct link to 6. Inicialização e Deploy" title="Direct link to 6. Inicialização e Deploy">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform fmt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan -var-file=&quot;dev.tfvars&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -var-file=&quot;dev.tfvars&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-verificação-dos-recursos">7. Verificação dos Recursos<a href="#7-verificação-dos-recursos" class="hash-link" aria-label="Direct link to 7. Verificação dos Recursos" title="Direct link to 7. Verificação dos Recursos">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az resource list --resource-group $(terraform output -raw resource_group_name) --output table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az vm list --resource-group $(terraform output -raw resource_group_name) --output table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-teste-de-conectividade-ssh">8. Teste de Conectividade SSH<a href="#8-teste-de-conectividade-ssh" class="hash-link" aria-label="Direct link to 8. Teste de Conectividade SSH" title="Direct link to 8. Teste de Conectividade SSH">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VM_IP=$(az network public-ip show --resource-group $(terraform output -raw resource_group_name) --name webapp-dev-pip-1 --query ipAddress -o tsv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform output -raw ssh_private_key_pem &gt; private_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod 600 private_key.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i private_key.pem azureuser@$VM_IP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-testes-práticos-dentro-da-vm">9. Testes Práticos (Dentro da VM)<a href="#9-testes-práticos-dentro-da-vm" class="hash-link" aria-label="Direct link to 9. Testes Práticos (Dentro da VM)" title="Direct link to 9. Testes Práticos (Dentro da VM)">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uname -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsblk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-verificação-de-custos">10. Verificação de Custos<a href="#10-verificação-de-custos" class="hash-link" aria-label="Direct link to 10. Verificação de Custos" title="Direct link to 10. Verificação de Custos">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az consumption usage list --output table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Monitorar custos em: https://portal.azure.com/#blade/Microsoft_Azure_CostManagement/Menu/overview&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-limpeza-dos-recursos">11. Limpeza dos Recursos<a href="#11-limpeza-dos-recursos" class="hash-link" aria-label="Direct link to 11. Limpeza dos Recursos" title="Direct link to 11. Limpeza dos Recursos">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -var-file=&quot;dev.tfvars&quot; -auto-approve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">az group list --output table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-funcionalidades-demonstradas">🎯 Funcionalidades Demonstradas<a href="#-funcionalidades-demonstradas" class="hash-link" aria-label="Direct link to 🎯 Funcionalidades Demonstradas" title="Direct link to 🎯 Funcionalidades Demonstradas">​</a></h2>
<ul>
<li>✅ Variables tipadas com validação</li>
<li>✅ Locals com lógica complexa</li>
<li>✅ Outputs informativos</li>
<li>✅ Count para múltiplos recursos</li>
<li>✅ Providers múltiplos (azurerm, random, tls)</li>
<li>✅ Recursos condicionais (backup, monitoring)</li>
<li>✅ Dynamic blocks</li>
<li>✅ Data sources</li>
<li>✅ Key Vault para secrets</li>
<li>✅ Auto-shutdown para economia</li>
<li>✅ Tags organizacionais</li>
<li>✅ Network Security Groups</li>
<li>✅ Managed Disks</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-estimativa-de-custos">💰 Estimativa de Custos<a href="#-estimativa-de-custos" class="hash-link" aria-label="Direct link to 💰 Estimativa de Custos" title="Direct link to 💰 Estimativa de Custos">​</a></h2>
<p><strong>Desenvolvimento</strong>: ~$8-15 USD/mês (com auto-shutdown)
<strong>Produção</strong>: ~$390-515 USD/mês (3 VMs com backup e monitoring)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-resultado-final">🏆 Resultado Final<a href="#-resultado-final" class="hash-link" aria-label="Direct link to 🏆 Resultado Final" title="Direct link to 🏆 Resultado Final">​</a></h2>
<p>Uma infraestrutura completa e profissional que demonstra domínio avançado do Terraform, seguindo boas práticas de IaC, segurança e gestão de custos.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/udemy/terraform-automacao/98-projeto-final"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Aula Final - Projeto Final Terraform</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/udemy/terraform-automacao/bonus-certificacao"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Guia de Estudos - HashiCorp Certified Terraform Associate (003)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introdução" class="table-of-contents__link toc-highlight">Introdução</a></li><li><a href="#arquitetura" class="table-of-contents__link toc-highlight">Arquitetura</a></li><li><a href="#pré-requisitos" class="table-of-contents__link toc-highlight">Pré-requisitos</a></li><li><a href="#passo-a-passo" class="table-of-contents__link toc-highlight">Passo a Passo</a><ul><li><a href="#1-criação-da-estrutura-do-projeto" class="table-of-contents__link toc-highlight">1. Criação da Estrutura do Projeto</a></li><li><a href="#2-configuração-do-gitignore" class="table-of-contents__link toc-highlight">2. Configuração do .gitignore</a></li><li><a href="#3-criação-dos-arquivos-terraform" class="table-of-contents__link toc-highlight">3. Criação dos Arquivos Terraform</a></li><li><a href="#4-configuração-dos-ambientes" class="table-of-contents__link toc-highlight">4. Configuração dos Ambientes</a></li><li><a href="#5-configuração-do-azure" class="table-of-contents__link toc-highlight">5. Configuração do Azure</a></li><li><a href="#6-inicialização-e-deploy" class="table-of-contents__link toc-highlight">6. Inicialização e Deploy</a></li><li><a href="#7-verificação-dos-recursos" class="table-of-contents__link toc-highlight">7. Verificação dos Recursos</a></li><li><a href="#8-teste-de-conectividade-ssh" class="table-of-contents__link toc-highlight">8. Teste de Conectividade SSH</a></li><li><a href="#9-testes-práticos-dentro-da-vm" class="table-of-contents__link toc-highlight">9. Testes Práticos (Dentro da VM)</a></li><li><a href="#10-verificação-de-custos" class="table-of-contents__link toc-highlight">10. Verificação de Custos</a></li><li><a href="#11-limpeza-dos-recursos" class="table-of-contents__link toc-highlight">11. Limpeza dos Recursos</a></li></ul></li><li><a href="#-funcionalidades-demonstradas" class="table-of-contents__link toc-highlight">🎯 Funcionalidades Demonstradas</a></li><li><a href="#-estimativa-de-custos" class="table-of-contents__link toc-highlight">💰 Estimativa de Custos</a></li><li><a href="#-resultado-final" class="table-of-contents__link toc-highlight">🏆 Resultado Final</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer_fXop"><div class="container_yNGW"><div><img src="/img/devops-logo.png" alt="Logo" class="logo_yP8X"><p class="follow_o8qg">Siga nas redes</p><ul class="socialList_o9Gv"><li><a href="https://www.youtube.com/channel/UCxRNzCKgqQ0FW0GKuRSjlEQ" target="_blank" rel="noopener noreferrer"><img src="/img/logos_youtube-icon.avif" alt="YouTube"><span>iesodias</span></a></li><li><a href="https://linkedin.com/in/iesodias" target="_blank" rel="noopener noreferrer"><img src="/img/devicon_linkedin.avif" alt="LinkedIn"><span>iesodias</span></a></li><li><a href="https://instagram.com/iesofdias" target="_blank" rel="noopener noreferrer"><img src="/img/skill-icons_instagram.avif" alt="Instagram"><span>iesofdias</span></a></li></ul></div><div><p class="newsletterTitle_Ceq2">Dúvidas?</p><p class="email_nAjm">Fale Comigo <br><a href="mailto:iesodias@gmail.com">iesodias@gmail.com</a></p></div><div><p class="sectionTitle_mBm8">Links rápidos</p><ul class="linkList_pzh5"><li><a href="#">Github</a></li><li><a href="#">Youtube</a></li><li><a href="#">Blog</a></li></ul></div><div><p class="sectionTitle_mBm8">Legal</p><ul class="linkList_pzh5"><li><a href="#">Termos</a></li><li><a href="#">Privacidade</a></li></ul></div></div></footer></div>
</body>
</html>