<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-terraform-automacao docs-version-current docs-doc-page docs-doc-id-25-lab-sentinel-tfc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local) | Aprenda DevOps do zero com tutoriais prático</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://devopsautomation.com.br/img/devops-logo-social.png"><meta data-rh="true" name="twitter:image" content="https://devopsautomation.com.br/img/devops-logo-social.png"><meta data-rh="true" property="og:url" content="https://devopsautomation.com.br/udemy/terraform-automacao/25-lab-sentinel-tfc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-terraform-automacao-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-terraform-automacao-current"><meta data-rh="true" property="og:title" content="Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local) | Aprenda DevOps do zero com tutoriais prático"><meta data-rh="true" name="description" content="Objetivo"><meta data-rh="true" property="og:description" content="Objetivo"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://devopsautomation.com.br/udemy/terraform-automacao/25-lab-sentinel-tfc"><link data-rh="true" rel="alternate" href="https://devopsautomation.com.br/udemy/terraform-automacao/25-lab-sentinel-tfc" hreflang="en"><link data-rh="true" rel="alternate" href="https://devopsautomation.com.br/udemy/terraform-automacao/25-lab-sentinel-tfc" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local)","item":"https://devopsautomation.com.br/udemy/terraform-automacao/25-lab-sentinel-tfc"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Aprenda DevOps do zero com tutoriais prático RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Aprenda DevOps do zero com tutoriais prático Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BRH4789ZE0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BRH4789ZE0",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.e0ab0b88.css">
<script src="/assets/js/runtime~main.6811eec7.js" defer="defer"></script>
<script src="/assets/js/main.b795c1ed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-home.png" alt="Logo DevOps Automation" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-home.png" alt="Logo DevOps Automation" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/intro">Tutoriais</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/#cursos">Cursos</a><a href="https://youtube.com/@iesodias" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/#instrutor">Instrutor</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao"><span title="Introdução" class="categoryLinkLabel_W154">Introdução</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/iac"><span title="Modulo 0 - Conceitos Iniciais" class="categoryLinkLabel_W154">Modulo 0 - Conceitos Iniciais</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/hcl-intro"><span title="Modulo 1 - Introdução ao Terraform" class="categoryLinkLabel_W154">Modulo 1 - Introdução ao Terraform</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-1-rg"><span title="Labs 1 - Introdução ao Terraform" class="categoryLinkLabel_W154">Labs 1 - Introdução ao Terraform</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/trivy-teorico"><span title="Modulo 2 - Análise Estática (SAST) para IaC" class="categoryLinkLabel_W154">Modulo 2 - Análise Estática (SAST) para IaC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-10-trivy"><span title="Labs 2 - Análise Estática (SAST) para IaC" class="categoryLinkLabel_W154">Labs 2 - Análise Estática (SAST) para IaC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/12-opa-teoria"><span title="Modulo 3 - Policy as Code (PaC)" class="categoryLinkLabel_W154">Modulo 3 - Policy as Code (PaC)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-15-confest-opa"><span title="Labs 3 - Policy as Code (PaC)" class="categoryLinkLabel_W154">Labs 3 - Policy as Code (PaC)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/17-modulos-teoria"><span title="Modulo 4 - Módulos no Terraform" class="categoryLinkLabel_W154">Modulo 4 - Módulos no Terraform</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/lab-18-modulos"><span title="Labs 4 - Módulos" class="categoryLinkLabel_W154">Labs 4 - Módulos</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/19-dados-sensiveis"><span title="Modulo 5 - Protegendo Dados Sensiveis com Vault" class="categoryLinkLabel_W154">Modulo 5 - Protegendo Dados Sensiveis com Vault</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/23-terraform-cloud"><span title="Modulo 6 - Terraform Cloud" class="categoryLinkLabel_W154">Modulo 6 - Terraform Cloud</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/udemy/terraform-automacao/25-lab-sentinel-tfc"><span title="Lab 6 - Terraform Cloud" class="categoryLinkLabel_W154">Lab 6 - Terraform Cloud</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/udemy/terraform-automacao/25-lab-sentinel-tfc"><span title="Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local)" class="linkLabel_WmDU">Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local)</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/01-terraform-ia-importancia"><span title="Modulo 7 - IA para IaC" class="categoryLinkLabel_W154">Modulo 7 - IA para IaC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/98-projeto-final"><span title="Projeto Final" class="categoryLinkLabel_W154">Projeto Final</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/udemy/terraform-automacao/bonus-certificacao"><span title="Certificação HashiCorp" class="categoryLinkLabel_W154">Certificação HashiCorp</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Lab 6 - Terraform Cloud</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Lab 25 - Criando um Resource Group no Azure com Terraform Cloud (Execução Local)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lab: Criando um Resource Group no Azure com Terraform Cloud (Execução Local)</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="objetivo">Objetivo<a href="#objetivo" class="hash-link" aria-label="Direct link to Objetivo" title="Direct link to Objetivo" translate="no">​</a></h2>
<p>Demonstrar como criar um <strong>Resource Group no Azure</strong> utilizando o <strong>Terraform Cloud como backend remoto</strong>, executando os comandos localmente na máquina do desenvolvedor.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="requisitos">Requisitos<a href="#requisitos" class="hash-link" aria-label="Direct link to Requisitos" title="Direct link to Requisitos" translate="no">​</a></h2>
<ul>
<li class="">Conta no <a href="https://app.terraform.io/" target="_blank" rel="noopener noreferrer" class="">Terraform Cloud</a></li>
<li class="">Azure CLI instalado e logado (<code>az login</code>)</li>
<li class="">Token de acesso ao Azure (Service Principal)</li>
<li class="">Token de acesso ao Terraform Cloud configurado localmente</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="criar-service-principal-e-obter-credenciais-passo-essencial">Criar Service Principal e obter credenciais (passo essencial)<a href="#criar-service-principal-e-obter-credenciais-passo-essencial" class="hash-link" aria-label="Direct link to Criar Service Principal e obter credenciais (passo essencial)" title="Direct link to Criar Service Principal e obter credenciais (passo essencial)" translate="no">​</a></h3>
<p>Execute o comando abaixo substituindo <code>&lt;sub_id&gt;</code> pelo ID da sua assinatura Azure:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az ad sp create-for-rbac --name &quot;terraform-tfc&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --role=&quot;Contributor&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --scopes=&quot;/subscriptions/&lt;sub_id&gt;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --sdk-auth</span><br></span></code></pre></div></div>
<p>Copie os valores do JSON retornado e use para configurar as variáveis de ambiente no Terraform Cloud.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="etapas-do-lab">Etapas do Lab<a href="#etapas-do-lab" class="hash-link" aria-label="Direct link to Etapas do Lab" title="Direct link to Etapas do Lab" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-criar-diretório-do-projeto">1. Criar diretório do projeto<a href="#1-criar-diretório-do-projeto" class="hash-link" aria-label="Direct link to 1. Criar diretório do projeto" title="Direct link to 1. Criar diretório do projeto" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir tfc-rg-lab &amp;&amp; cd tfc-rg-lab</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-criar-arquivos-base">2. Criar arquivos base<a href="#2-criar-arquivos-base" class="hash-link" aria-label="Direct link to 2. Criar arquivos base" title="Direct link to 2. Criar arquivos base" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">touch main.tf variables.tf terraform.tfvars outputs.tf</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-arquivo-maintf">3. Arquivo <code>main.tf</code><a href="#3-arquivo-maintf" class="hash-link" aria-label="Direct link to 3-arquivo-maintf" title="Direct link to 3-arquivo-maintf" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_providers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    azurerm = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/azurerm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 3.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cloud {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organization = &quot;sua-organizacao&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workspaces {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name = &quot;rg-azure-lab&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;azurerm&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  features {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;azurerm_resource_group&quot; &quot;rg&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name     = var.resource_group_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location = var.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-arquivo-variablestf">4. Arquivo <code>variables.tf</code><a href="#4-arquivo-variablestf" class="hash-link" aria-label="Direct link to 4-arquivo-variablestf" title="Direct link to 4-arquivo-variablestf" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;resource_group_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;location&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-arquivo-terraformtfvars">5. Arquivo <code>terraform.tfvars</code><a href="#5-arquivo-terraformtfvars" class="hash-link" aria-label="Direct link to 5-arquivo-terraformtfvars" title="Direct link to 5-arquivo-terraformtfvars" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resource_group_name = &quot;rg-from-tfc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location            = &quot;eastus&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-arquivo-outputstf">6. Arquivo <code>outputs.tf</code><a href="#6-arquivo-outputstf" class="hash-link" aria-label="Direct link to 6-arquivo-outputstf" title="Direct link to 6-arquivo-outputstf" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;rg_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value = azurerm_resource_group.rg.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-criar-workspace-no-terraform-cloud">7. Criar Workspace no Terraform Cloud<a href="#7-criar-workspace-no-terraform-cloud" class="hash-link" aria-label="Direct link to 7. Criar Workspace no Terraform Cloud" title="Direct link to 7. Criar Workspace no Terraform Cloud" translate="no">​</a></h2>
<ol>
<li class="">Acesse <a href="https://app.terraform.io/" target="_blank" rel="noopener noreferrer" class="">Terraform Cloud</a></li>
<li class="">Crie uma nova organização ou use uma existente</li>
<li class="">Crie um novo <strong>Workspace CLI-Driven</strong> com o nome <code>rg-azure-lab</code></li>
<li class="">Na aba <strong>Variables</strong>, adicione as seguintes variáveis de ambiente:</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="variáveis-de-ambiente-environment-variables">Variáveis de Ambiente (Environment Variables)<a href="#variáveis-de-ambiente-environment-variables" class="hash-link" aria-label="Direct link to Variáveis de Ambiente (Environment Variables)" title="Direct link to Variáveis de Ambiente (Environment Variables)" translate="no">​</a></h3>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ARM_CLIENT_ID        = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARM_CLIENT_SECRET    = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARM_SUBSCRIPTION_ID  = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARM_TENANT_ID        = xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</span><br></span></code></pre></div></div>
<blockquote>
<p>Essas credenciais são obtidas no passo anterior com <code>az ad sp create-for-rbac</code></p>
</blockquote>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-configurar-autenticação-do-terraform-cloud-localmente">8. Configurar autenticação do Terraform Cloud localmente<a href="#8-configurar-autenticação-do-terraform-cloud-localmente" class="hash-link" aria-label="Direct link to 8. Configurar autenticação do Terraform Cloud localmente" title="Direct link to 8. Configurar autenticação do Terraform Cloud localmente" translate="no">​</a></h2>
<p>Crie o arquivo <code>~/.terraformrc</code> (Linux/macOS) ou <code>%APPDATA%\terraform.rc</code> (Windows):</p>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">credentials &quot;app.terraform.io&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token = &quot;seu-token-do-terraform-cloud&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="9-executar-os-comandos-terraform-localmente">9. Executar os comandos Terraform localmente<a href="#9-executar-os-comandos-terraform-localmente" class="hash-link" aria-label="Direct link to 9. Executar os comandos Terraform localmente" title="Direct link to 9. Executar os comandos Terraform localmente" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan -out=tfplan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply tfplan</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="output-esperado-no-terminal-local">Output esperado (no terminal local)<a href="#output-esperado-no-terminal-local" class="hash-link" aria-label="Direct link to Output esperado (no terminal local)" title="Direct link to Output esperado (no terminal local)" translate="no">​</a></h2>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rg_name = &quot;rg-from-tfc&quot;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="10-opcional-criar-policy-sentinel-de-teste">10. (Opcional) Criar Policy Sentinel de Teste<a href="#10-opcional-criar-policy-sentinel-de-teste" class="hash-link" aria-label="Direct link to 10. (Opcional) Criar Policy Sentinel de Teste" title="Direct link to 10. (Opcional) Criar Policy Sentinel de Teste" translate="no">​</a></h2>
<p>Para testar o Sentinel com Terraform Cloud, crie a seguinte policy simples:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="policy-restrict-regionsentinel">Policy: <code>restrict-region.sentinel</code><a href="#policy-restrict-regionsentinel" class="hash-link" aria-label="Direct link to policy-restrict-regionsentinel" title="Direct link to policy-restrict-regionsentinel" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Importa o mock do plano do Terraform para análise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;tfplan/v2&quot; as tfplan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Define a região permitida como uma variável local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allowed_location = &quot;eastus&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Encontra todos os Azure Resource Groups que estão sendo criados ou atualizados no plano</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all_resource_groups = filter tfplan.resource_changes as _, rc {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rc.type is &quot;azurerm_resource_group&quot; and</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		(rc.change.actions contains &quot;create&quot; or rc.change.actions contains &quot;update&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Regra de validação: Verifica se a localização de cada Resource Group é a permitida</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location_is_valid = rule {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	all all_resource_groups as _, rg {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rg.change.after.location is allowed_location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Regra principal (main) - O resultado desta regra determina o sucesso ou falha da policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main = rule {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	location_is_valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="passos-para-aplicar">Passos para aplicar:<a href="#passos-para-aplicar" class="hash-link" aria-label="Direct link to Passos para aplicar:" title="Direct link to Passos para aplicar:" translate="no">​</a></h3>
<ol>
<li class="">No Terraform Cloud, vá até a organização → <strong>Policies</strong></li>
<li class="">Clique em <strong>Create Policy</strong>, cole o código acima</li>
<li class="">Publique a policy</li>
<li class="">Vá em <strong>Policy Sets</strong> e associe ao workspace <code>rg-azure-lab</code></li>
<li class="">Use enforcement <code>advisory</code> para testes</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="considerações-finais">Considerações finais<a href="#considerações-finais" class="hash-link" aria-label="Direct link to Considerações finais" title="Direct link to Considerações finais" translate="no">​</a></h2>
<ul>
<li class="">Utilize <code>terraform.tfvars</code> para valores por ambiente</li>
<li class="">O estado será armazenado no Terraform Cloud de forma segura</li>
<li class="">Sempre adicione variáveis sensíveis como secret na interface do Terraform Cloud</li>
<li class="">O <code>az login</code> é útil localmente, mas <strong>não é usado pelo Terraform Cloud</strong>, mesmo com execução CLI</li>
<li class="">Use Workspaces CLI-driven para essa abordagem híbrida</li>
<li class="">O Sentinel permite implementar validações e políticas de segurança no fluxo de CI/CD</li>
</ul>
<p>Esse lab demonstra como usar o Terraform Cloud como backend, mantendo a execução local. Excelente para práticas seguras, políticas organizacionais e preparação para ambientes colaborativos e certificações.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/udemy/terraform-automacao/24-sentinel"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Aula 24 - Sentinel no Terraform Cloud</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/udemy/terraform-automacao/01-terraform-ia-importancia"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Inteligência Artificial como Assistente no Desenvolvimento com Terraform</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objetivo" class="table-of-contents__link toc-highlight">Objetivo</a></li><li><a href="#requisitos" class="table-of-contents__link toc-highlight">Requisitos</a><ul><li><a href="#criar-service-principal-e-obter-credenciais-passo-essencial" class="table-of-contents__link toc-highlight">Criar Service Principal e obter credenciais (passo essencial)</a></li></ul></li><li><a href="#etapas-do-lab" class="table-of-contents__link toc-highlight">Etapas do Lab</a><ul><li><a href="#1-criar-diretório-do-projeto" class="table-of-contents__link toc-highlight">1. Criar diretório do projeto</a></li><li><a href="#2-criar-arquivos-base" class="table-of-contents__link toc-highlight">2. Criar arquivos base</a></li><li><a href="#3-arquivo-maintf" class="table-of-contents__link toc-highlight">3. Arquivo <code>main.tf</code></a></li><li><a href="#4-arquivo-variablestf" class="table-of-contents__link toc-highlight">4. Arquivo <code>variables.tf</code></a></li><li><a href="#5-arquivo-terraformtfvars" class="table-of-contents__link toc-highlight">5. Arquivo <code>terraform.tfvars</code></a></li><li><a href="#6-arquivo-outputstf" class="table-of-contents__link toc-highlight">6. Arquivo <code>outputs.tf</code></a></li></ul></li><li><a href="#7-criar-workspace-no-terraform-cloud" class="table-of-contents__link toc-highlight">7. Criar Workspace no Terraform Cloud</a><ul><li><a href="#variáveis-de-ambiente-environment-variables" class="table-of-contents__link toc-highlight">Variáveis de Ambiente (Environment Variables)</a></li></ul></li><li><a href="#8-configurar-autenticação-do-terraform-cloud-localmente" class="table-of-contents__link toc-highlight">8. Configurar autenticação do Terraform Cloud localmente</a></li><li><a href="#9-executar-os-comandos-terraform-localmente" class="table-of-contents__link toc-highlight">9. Executar os comandos Terraform localmente</a></li><li><a href="#output-esperado-no-terminal-local" class="table-of-contents__link toc-highlight">Output esperado (no terminal local)</a></li><li><a href="#10-opcional-criar-policy-sentinel-de-teste" class="table-of-contents__link toc-highlight">10. (Opcional) Criar Policy Sentinel de Teste</a><ul><li><a href="#policy-restrict-regionsentinel" class="table-of-contents__link toc-highlight">Policy: <code>restrict-region.sentinel</code></a></li><li><a href="#passos-para-aplicar" class="table-of-contents__link toc-highlight">Passos para aplicar:</a></li></ul></li><li><a href="#considerações-finais" class="table-of-contents__link toc-highlight">Considerações finais</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer_fXop"><div class="container_yNGW"><div><img src="/img/devops-logo.png" alt="Logo" class="logo_yP8X"><p class="follow_o8qg">Siga nas redes</p><ul class="socialList_o9Gv"><li><a href="https://www.youtube.com/channel/UCxRNzCKgqQ0FW0GKuRSjlEQ" target="_blank" rel="noopener noreferrer"><img src="/img/logos_youtube-icon.avif" alt="YouTube"><span>iesodias</span></a></li><li><a href="https://linkedin.com/in/iesodias" target="_blank" rel="noopener noreferrer"><img src="/img/devicon_linkedin.avif" alt="LinkedIn"><span>iesodias</span></a></li><li><a href="https://instagram.com/iesofdias" target="_blank" rel="noopener noreferrer"><img src="/img/skill-icons_instagram.avif" alt="Instagram"><span>iesofdias</span></a></li></ul></div><div><p class="newsletterTitle_Ceq2">Dúvidas?</p><p class="email_nAjm">Fale Comigo <br><a href="mailto:iesodias@gmail.com">iesodias@gmail.com</a></p></div><div><p class="sectionTitle_mBm8">Links rápidos</p><ul class="linkList_pzh5"><li><a href="#">Github</a></li><li><a href="#">Youtube</a></li><li><a href="#">Blog</a></li></ul></div><div><p class="sectionTitle_mBm8">Legal</p><ul class="linkList_pzh5"><li><a href="#">Termos</a></li><li><a href="#">Privacidade</a></li></ul></div></div></footer></div>
</body>
</html>